/*
YUI 3.15.0 (build 834026e)
Copyright 2014 Yahoo! Inc. All rights reserved.
Licensed under the BSD License.
http://yuilibrary.com/license/
*/

YUI.add("node-menunav",function(e,t){var n=e.UA,r=e.later,i=e.ClassNameManager.getClassName,s="menu",o="menuitem",u="hidden",a="parentNode",f="children",l="offsetHeight",c="offsetWidth",h="px",p="id",d=".",v="handledMouseOut",m="handledMouseOver",g="active",y="label",b="a",w="mousedown",E="keydown",S="click",x="",T="first-of-type",N="role",C="presentation",k="descendants",L="UI",A="activeDescendant",O="useARIA",M="aria-hidden",_="content",D="host",P=A+"Change",H="autoSubmenuDisplay",B="mouseOutHideDelay",j=i(s),F=i(s,u),I=i(s,"horizontal"),q=i(s,y),R=i(s,y,g),U=i(s,y,s+"visible"),z=i(o),W=i(o,g),X=d+j,V=d+i(s,"toggle"),$=d+i(s,_),J=d+q,K=">"+$+">ul>li>a",Q=">"+$+">ul>li>"+J+">a:first-child",G=function(e){var t=e.previous(),n;return t||(n=e.get(a).get(f),t=n.item(n.size()-1)),t},Y=function(e){var t=e.next();return t||(t=e.get(a).get(f).item(0)),t},Z=function(e){var t=!1;return e&&(t=e.get("nodeName").toLowerCase()===b),t},et=function(e){return e.hasClass(z)},tt=function(e){return e.hasClass(q)},nt=function(e){return e.hasClass(I)},rt=function(e){return e.hasClass(U)},it=function(e){return Z(e)?e:e.one(b)},st=function(e,t,n){var r;return e&&(e.hasClass(t)&&(r=e),!r&&n&&(r=e.ancestor(d+t))),r},ot=function(e){return e.ancestor(X)},ut=function(e,t){return st(e,j,t)},at=function(e,t){var n;return e&&(n=st(e,z,t)),n},ft=function(e,t){var n;return e&&(t?n=st(e,q,t):n=st(e,q)||e.one(d+q)),n},lt=function(e,t){var n;return e&&(n=at(e,t)||ft(e,t)),n},ct=function(e){return lt(e.one("li"))},ht=function(e){return et(e)?W:R},pt=function(e,t){return e&&!e[m]&&(e.compareTo(t)||e.contains(t))},dt=function(e,t){return e&&!e[v]&&!e.compareTo(t)&&!e.contains(t)},vt=function(){vt.superclass.constructor.apply(this,arguments)};vt.NAME="nodeMenuNav",vt.NS="menuNav",vt.SHIM_TEMPLATE_TITLE="Menu Stacking Shim",vt.SHIM_TEMPLATE='<iframe frameborder="0" tabindex="-1" class="'+i("shim")+'" title="'+vt.SHIM_TEMPLATE_TITLE+'" src="javascript:false;"></iframe>',vt.ATTRS={useARIA:{value:!0,writeOnce:!0,lazyAdd:!1,setter:function(t){var n=this.get(D),r,u,a,f;t&&(n.set(N,s),n.all("ul,li,"+$).set(N,C),n.all(d+i(o,_)).set(N,o),n.all(d+q).each(function(t){r=t,u=t.one(V),u&&(u.set(N,C),r=u.previous()),r.set(N,o),r.set("aria-haspopup",!0),a=t.next(),a&&(a.set(N,s),r=a.previous(),u=r.one(V),u&&(r=u),f=e.stamp(r),r.get(p)||r.set(p,f),a.set("aria-labelledby",f),a.set(M,!0))}))}},autoSubmenuDisplay:{value:!0,writeOnce:!0},submenuShowDelay:{value:250,writeOnce:!0},submenuHideDelay:{value:250,writeOnce:!0},mouseOutHideDelay:{value:750,writeOnce:!0}},e.extend(vt,e.Plugin.Base,{_rootMenu:null,_activeItem:null,_activeMenu:null,_hasFocus:!1,_blockMouseEvent:!1,_currentMouseX:0,_movingToSubmenu:!1,_showSubmenuTimer:null,_hideSubmenuTimer:null,_hideAllSubmenusTimer:null,_firstItem:null,initializer:function(t){var n=this,r=this.get(D),i=[],s;r&&(n._rootMenu=r,r.all("ul:first-child").addClass(T),r.all(X).addClass(F),i.push(r.on("mouseover",n._onMouseOver,n)),i.push(r.on("mouseout",n._onMouseOut,n)),i.push(r.on("mousemove",n._onMouseMove,n)),i.push(r.on(w,n._toggleSubmenuDisplay,n)),i.push(e.on("key",n._toggleSubmenuDisplay,r,"down:13",n)),i.push(r.on(S,n._toggleSubmenuDisplay,n)),i.push(r.on("keypress",n._onKeyPress,n)),i.push(r.on(E,n._onKeyDown,n)),s=r.get("ownerDocument"),i.push(s.on(w,n._onDocMouseDown,n)),i.push(s.on("focus",n._onDocFocus,n)),this._eventHandlers=i,n._initFocusManager())},destructor:function(){var t=this._eventHandlers;t&&(e.Array.each(t,function(e){e.detach()}),this._eventHandlers=null),this.get(D).unplug("focusManager")},_isRoot:function(e){return this._rootMenu.compareTo(e)},_getTopmostSubmenu:function(e){var t=this,n=ot(e),r;return n?t._isRoot(n)?r=e:r=t._getTopmostSubmenu(n):r=e,r},_clearActiveItem:function(){var e=this,t=e._activeItem;t&&t.removeClass(ht(t)),e._activeItem=null},_setActiveItem:function(e){var t=this;e&&(t._clearActiveItem(),e.addClass(ht(e)),t._activeItem=e)},_focusItem:function(e){var t=this,n,r;e&&t._hasFocus&&(n=ot(e),r=it(e),n&&!n.compareTo(t._activeMenu)&&(t._activeMenu=n,t._initFocusManager()),t._focusManager.focus(r))},_showMenu:function(t){var r=ot(t),i=t.get(a),s=i.getXY();this.get(O)&&t.set(M,!1),nt(r)?s[1]=s[1]+i.get(l):s[0]=s[0]+i.get(c),t.setXY(s),n.ie<8&&(n.ie===6&&!t.hasIFrameShim&&(t.appendChild(e.Node.create(vt.SHIM_TEMPLATE)),t.hasIFrameShim=!0),t.setStyles({height:x,width:x}),t.setStyles({height:t.get(l)+h,width:t.get(c)+h})),t.previous().addClass(U),t.removeClass(F)},_hideMenu:function(e,t){var n=this,r=e.previous(),i;r.removeClass(U),t&&(n._focusItem(r),n._setActiveItem(r)),i=e.one(d+W),i&&i.removeClass(W),e.setStyles({left:x,top:x}),e.addClass(F),n.get(O)&&e.set(M,!0)},_hideAllSubmenus:function(t){var n=this;t.all(X).each(e.bind(function(e){n._hideMenu(e)},n))},_cancelShowSubmenuTimer:function(){var e=this,t=e._showSubmenuTimer;t&&(t.cancel(),e._showSubmenuTimer=null)},_cancelHideSubmenuTimer:function(){var e=this,t=e._hideSubmenuTimer;t&&(t.cancel(),e._hideSubmenuTimer=null)},_initFocusManager:function(){var t=this,n=t._rootMenu,r=t._activeMenu||n,i=t._isRoot(r)?x:"#"+r.get("id"),s=t._focusManager,o,u,a;nt(r)?(u=i+K+","+i+Q,o={next:"down:39",previous:"down:37"}):(u=i+K,o={next:"down:40",previous:"down:38"}),s?(s.set(A,-1),s.set(k,u),s.set("keys",o)):(n.plug(e.Plugin.NodeFocusManager,{descendants:u,keys:o,circular:!0}),s=n.focusManager,a="#"+n.get("id")+X+" a,"+V,n.all(a).set("tabIndex",-1),s.on(P,this._onActiveDescendantChange,s,this),s.after(P,this._afterActiveDescendantChange,s,this),t._focusManager=s)},_onActiveDescendantChange:function(e,t){e.src===L&&t._activeMenu&&!t._movingToSubmenu&&t._hideAllSubmenus(t._activeMenu)},_afterActiveDescendantChange:function(e,t){var n;e.src===L&&(n=lt(this.get(k).item(e.newVal),!0),t._setActiveItem(n))},_onDocFocus:function(e){var t=this,n=t._activeItem,r=e.target,i;t._rootMenu.contains(r)?t._hasFocus?(i=ot(r),t._activeMenu.compareTo(i)||(t._activeMenu=i,t._initFocusManager(),t._focusManager.set(A,r),t._setActiveItem(lt(r,!0)))):(t._hasFocus=!0
,n=lt(r,!0),n&&t._setActiveItem(n)):(t._clearActiveItem(),t._cancelShowSubmenuTimer(),t._hideAllSubmenus(t._rootMenu),t._activeMenu=t._rootMenu,t._initFocusManager(),t._focusManager.set(A,0),t._hasFocus=!1)},_onMenuMouseOver:function(e,t){var n=this,r=n._hideAllSubmenusTimer;r&&(r.cancel(),n._hideAllSubmenusTimer=null),n._cancelHideSubmenuTimer(),e&&!e.compareTo(n._activeMenu)&&(n._activeMenu=e,n._hasFocus&&n._initFocusManager()),n._movingToSubmenu&&nt(e)&&(n._movingToSubmenu=!1)},_hideAndFocusLabel:function(){var e=this,t=e._activeMenu,n;e._hideAllSubmenus(e._rootMenu),t&&(n=e._getTopmostSubmenu(t),e._focusItem(n.previous()))},_onMenuMouseOut:function(e,t){var n=this,i=n._activeMenu,s=t.relatedTarget,o=n._activeItem,u,a;i&&!i.contains(s)&&(u=ot(i),u&&!u.contains(s)?n.get(B)>0&&(n._cancelShowSubmenuTimer(),n._hideAllSubmenusTimer=r(n.get(B),n,n._hideAndFocusLabel)):o&&(a=ot(o),n._isRoot(a)||n._focusItem(a.previous())))},_onMenuLabelMouseOver:function(e,t){var n=this,i=n._activeMenu,s=n._isRoot(i),o=n.get(H)&&s||!s,u=n.get("submenuShowDelay"),a,f=function(t){n._cancelHideSubmenuTimer(),n._cancelShowSubmenuTimer(),rt(e)||(a=e.next(),a&&(n._hideAllSubmenus(i),n._showSubmenuTimer=r(t,n,n._showMenu,a)))};n._focusItem(e),n._setActiveItem(e),o&&(n._movingToSubmenu?n._hoverTimer=r(u,n,function(){f(0)}):f(u))},_onMenuLabelMouseOut:function(e,t){var n=this,i=n._isRoot(n._activeMenu),s=n.get(H)&&i||!i,o=t.relatedTarget,u=e.next(),a=n._hoverTimer;a&&a.cancel(),n._clearActiveItem(),s&&(n._movingToSubmenu&&!n._showSubmenuTimer&&u?n._hideSubmenuTimer=r(n.get("submenuHideDelay"),n,n._hideMenu,u):!n._movingToSubmenu&&u&&(!o||o&&!u.contains(o)&&!o.compareTo(u))&&(n._cancelShowSubmenuTimer(),n._hideMenu(u)))},_onMenuItemMouseOver:function(e,t){var n=this,r=n._activeMenu,i=n._isRoot(r),s=n.get(H)&&i||!i;n._focusItem(e),n._setActiveItem(e),s&&!n._movingToSubmenu&&n._hideAllSubmenus(r)},_onMenuItemMouseOut:function(e,t){this._clearActiveItem()},_onVerticalMenuKeyDown:function(e){var t=this,n=t._activeMenu,r=t._rootMenu,i=e.target,s=!1,o=e.keyCode,u,f,l,c;switch(o){case 37:f=ot(n),f&&nt(f)?(t._hideMenu(n),l=G(n.get(a)),c=lt(l),c&&(tt(c)?(u=c.next(),u?(t._showMenu(u),t._focusItem(ct(u)),t._setActiveItem(ct(u))):(t._focusItem(c),t._setActiveItem(c))):(t._focusItem(c),t._setActiveItem(c)))):t._isRoot(n)||t._hideMenu(n,!0),s=!0;break;case 39:tt(i)?(u=i.next(),u&&(t._showMenu(u),t._focusItem(ct(u)),t._setActiveItem(ct(u)))):nt(r)&&(u=t._getTopmostSubmenu(n),l=Y(u.get(a)),c=lt(l),t._hideAllSubmenus(r),c&&(tt(c)?(u=c.next(),u?(t._showMenu(u),t._focusItem(ct(u)),t._setActiveItem(ct(u))):(t._focusItem(c),t._setActiveItem(c))):(t._focusItem(c),t._setActiveItem(c)))),s=!0}s&&e.preventDefault()},_onHorizontalMenuKeyDown:function(e){var t=this,n=t._activeMenu,r=e.target,i=lt(r,!0),s=!1,o=e.keyCode,u;o===40&&(t._hideAllSubmenus(n),tt(i)&&(u=i.next(),u&&(t._showMenu(u),t._focusItem(ct(u)),t._setActiveItem(ct(u))),s=!0)),s&&e.preventDefault()},_onMouseMove:function(e){var t=this;r(10,t,function(){t._currentMouseX=e.pageX})},_onMouseOver:function(e){var t=this,n,r,i,s,o;t._blockMouseEvent?t._blockMouseEvent=!1:(n=e.target,r=ut(n,!0),i=ft(n,!0),o=at(n,!0),pt(r,n)&&(t._onMenuMouseOver(r,e),r[m]=!0,r[v]=!1,s=ot(r),s&&(s[v]=!0,s[m]=!1)),pt(i,n)&&(t._onMenuLabelMouseOver(i,e),i[m]=!0,i[v]=!1),pt(o,n)&&(t._onMenuItemMouseOver(o,e),o[m]=!0,o[v]=!1))},_onMouseOut:function(e){var t=this,n=t._activeMenu,r=!1,i,s,o,u,a,f;t._movingToSubmenu=n&&!nt(n)&&e.pageX-5>t._currentMouseX,i=e.target,s=e.relatedTarget,o=ut(i,!0),u=ft(i,!0),f=at(i,!0),dt(u,s)&&(t._onMenuLabelMouseOut(u,e),u[v]=!0,u[m]=!1),dt(f,s)&&(t._onMenuItemMouseOut(f,e),f[v]=!0,f[m]=!1),u&&(a=u.next(),a&&s&&(s.compareTo(a)||a.contains(s))&&(r=!0));if(dt(o,s)||r)t._onMenuMouseOut(o,e),o[v]=!0,o[m]=!1},_toggleSubmenuDisplay:function(e){var t=this,r=e.target,i=ft(r,!0),s=e.type,o,u,a,f,l,c;if(i){o=Z(r)?r:r.ancestor(Z);if(o){a=o.getAttribute("href",2),f=a.indexOf("#"),l=a.length;if(f===0&&l>1){c=a.substr(1,l),u=i.next();if(u&&u.get(p)===c){if(s===w||s===E)(n.opera||n.gecko||n.ie)&&s===E&&!t._preventClickHandle&&(t._preventClickHandle=t._rootMenu.on("click",function(e){e.preventDefault(),t._preventClickHandle.detach(),t._preventClickHandle=null})),s==w&&(e.preventDefault(),e.stopImmediatePropagation(),t._hasFocus=!0),t._isRoot(ot(r))?rt(i)?(t._hideMenu(u),t._focusItem(i),t._setActiveItem(i)):(t._hideAllSubmenus(t._rootMenu),t._showMenu(u),t._focusItem(ct(u)),t._setActiveItem(ct(u))):t._activeItem==i?(t._showMenu(u),t._focusItem(ct(u)),t._setActiveItem(ct(u))):i._clickHandle||(i._clickHandle=i.on("click",function(){t._hideAllSubmenus(t._rootMenu),t._hasFocus=!1,t._clearActiveItem(),i._clickHandle.detach(),i._clickHandle=null}));s===S&&e.preventDefault()}}}}},_onKeyPress:function(e){switch(e.keyCode){case 37:case 38:case 39:case 40:e.preventDefault()}},_onKeyDown:function(e){var t=this,i=t._activeItem,s=e.target,o=ot(s),u;o&&(t._activeMenu=o,nt(o)?t._onHorizontalMenuKeyDown(e):t._onVerticalMenuKeyDown(e),e.keyCode===27&&(t._isRoot(o)?i&&(tt(i)&&rt(i)?(u=i.next(),u&&t._hideMenu(u)):(t._focusManager.blur(),t._clearActiveItem(),t._hasFocus=!1)):(n.opera?r(0,t,function(){t._hideMenu(o,!0)}):t._hideMenu(o,!0),e.stopPropagation(),t._blockMouseEvent=n.gecko?!0:!1)))},_onDocMouseDown:function(e){var t=this,r=t._rootMenu,i=e.target;!r.compareTo(i)&&!r.contains(i)&&(t._hideAllSubmenus(r),n.webkit&&(t._hasFocus=!1,t._clearActiveItem()))}}),e.namespace("Plugin"),e.Plugin.NodeMenuNav=vt},"3.15.0",{requires:["node","classnamemanager","plugin","node-focusmanager"],skinnable:!0});
YUI.add("yg-rte",function(e){var c=[["000000","808080","ffffff"],["9d1811","cd232c","d36a53"],["a46016","dd902f","e4ac64"],["ac9e19","fdef2b","fdf869"],["8fca40","8fca40","add773"],["4c76a2","70aced","7dbef1"],["440062","652191","845aa7"],["9c005c","cb008e","d264aa"]];var h=e.helper.rteswitch,b="'Helvetica Neue',Helvetica,Arial,san-serif,Roboto",f="13px",d=[10,13,0,18,0,24,0],k={CARD_WIDTH:450,BIG_CARD_IM_PART_HEIGHT:170,SMALL_CARD_IM_PART_HEIGHT:60,BIG_CARD_IM_WIDTH:168,BIG_CARD_IM_HEIGHT:168,SMALL_CARD_IM_WIDTH:58,SMALL_CARD_IM_HEIGHT:58,BORDER_WIDTH:1,SMALL_CARD_VIEW_ON_HEIGHT:24,BIG_CARD_VIEW_ON_HEIGHT:38,PREVIEW_BY_MAX_WIDTH:100,PREVIEW_BY_MIN_WIDTH:80,PREVIEW_BY_PADDING_RIGHT_COMPOSE:60};function m(p,n){var o;if(!p){return}if(!n){return p}if(!!p.get("className")&&p.get("className").indexOf("link-enhancr-element")>=0){o=p.ancestor("div.link-enhancr-attachment",true)}else{o=p.ancestor(function(q){return(q.getStyle("display")==="block"||q.get("id")===n.get("id"))},true)}if(o.get("id")===n.get("id")){e.log("Should not get the RTE container. There is a Problem.")}if(o.get("className").indexOf("yahoo_quoted")>=0){o=p}return o}function l(s,t,p){var o,r=false,q=s.get("clientHeight"),n=p?p:s;if(s.get("scrollHeight")-q>5){r=true;o=n.getContent();while(s.get("scrollHeight")-q>5&&o.length>0){o=o.slice(0,-1);n.setHTML(o)}}if(r&&t){o=o.substring(0,o.length-3)+"...";n.setHTML(o)}}function j(o,n){if(o&&o.length>n){o=o.substring(0,n);o+="..."}return o}function g(t,r,o){var q,s={},p=function(x,w,v,y){var z={};w=parseInt(w,10);v=parseInt(v,10);x.originImageWidth=w;x.originImageHeight=v;s=u(x,w,v);z=n(w,v);x.imageWidth=z.imageWidth;x.imageHeight=z.imageHeight;x.imageDetails=(y?"after":"before:")+t.imageWidth+"x"+t.imageHeight;i(x);o(x)},u=function(w){var x={},v;v=k.CARD_WIDTH-(w.hasImage?(w.useBigCard?k.BIG_CARD_IM_WIDTH:k.SMALL_CARD_IM_WIDTH)+3*k.BORDER_WIDTH:2*k.BORDER_WIDTH);w.cardTextPartWidth=v;w.cardViewOnMaxWidth=v-k.PREVIEW_BY_MAX_WIDTH;w.cardViewOnMinWidth=w.cardViewOnMaxWidth-k.PREVIEW_BY_PADDING_RIGHT_COMPOSE;x=w.useBigCard?{width:k.BIG_CARD_IM_WIDTH,height:k.BIG_CARD_IM_HEIGHT}:{width:k.SMALL_CARD_IM_WIDTH,height:k.SMALL_CARD_IM_HEIGHT};w.cardTextPartHeight=(w.useBigCard?k.BIG_CARD_IM_HEIGHT-k.BIG_CARD_VIEW_ON_HEIGHT:k.SMALL_CARD_IM_HEIGHT-k.SMALL_CARD_VIEW_ON_HEIGHT);w.imageSize=w.useBigCard?k.BIG_CARD_IM_WIDTH:k.SMALL_CARD_IM_WIDTH;w.cardHeight=w.useBigCard?k.BIG_CARD_IM_PART_HEIGHT:k.SMALL_CARD_IM_PART_HEIGHT;return x},n=function(w,v){var x,y;y=s;if(w>y.width||v>y.height){x=Math.max(w/y.width,v/y.height);w=Math.round(w/x);v=Math.round(v/x)}else{if(w<y.width&&v<y.height){x=Math.min(y.width/w,y.height/v);w=Math.round(w*x);v=Math.round(v*x)}}return{imageWidth:w,imageHeight:v}};if(t.imageHeight&&t.imageWidth){p(r,t.imageWidth,t.imageHeight,false)}else{q=new Image();q.onload=function(){p(r,q.width,q.height,true)};q.onerror=function(){r.hasImage=false;i(r);o(r)};q.onabort=q.onerror;q.src=t.url}}function i(r){var n=r.useBigCard?(r.hasImage?56:100):(r.hasImage?58:67),p=r.useBigCard?(r.hasImage?164:281):(r.hasImage?79:90),q=r.title,o=r.description;if(n&&q){r.title=j(q,n)}if(p&&o){r.description=j(o,p)}}var a=e.Base.create("base",e.Base,[],{initializer:function(){var n=this;GROUPS.Y.use("editor-inline","createlink-base","editor-bidi","yg-enhancr-autolink","event-outside","color-base",function(v){var r,p=[],s=n.get("toolbar");n.node=v.one("#yg-main-content");n._evt=[];n.enhancrSupported=(n.get("enhancrEnabled")&&GROUPS.CONFIG.enhancrEnabled);n._linksCount=0;n._enhancedSuccess=0;n._enhancedLinks=0;n._processedLinks=[];n._enhancedNodes=[];n._compiledEnhancer="";n._timers=[];n._currentDomain=GROUPS.HTTP_PROTOCOL+window.location.host;n.defaultContent=n.get("editorContainer").getAttribute("data-default-content");n.textAreaNode=v.Node.create('<textarea placeholder="'+GROUPS.YRB_STRINGS.STR_WRITE_NEW_MESSAGE+'" id="plain-txt-area" class="plain-txt-area"></textarea>');var u=new v.CacheOffline({max:100,uniqueKeys:false,expires:60000}),q=u.retrieve("zax_sharephoto")?u.retrieve("zax_sharephoto").response:"";r=new v.InlineEditor({defaultblock:"p",content:(q!=""||n.get("editMode")===true)?"":n.defaultContent,extracss:"p {margin:0px;}"});r.plug(v.Plugin.CreateLinkBase);r.plug(v.Plugin.CreateLinkBase);r.plug(v.Groups.enhancr.AutolinkPlugin);if(GROUPS.DIRECTION=="rtl"){r.plug(v.Plugin.EditorBidi)}n.publish("pv:added",{emitFacade:true});n.publish("pv:removed",{emitFacade:true});n.publish("rte:ready",{emitFacade:true});p.push(n.after("boldChange",function(w){s.one(".btn-bold").toggleClass("selected")}));p.push(n.after("italicChange",function(w){s.one(".italic").toggleClass("selected")}));p.push(n.after("underlineChange",function(w){s.one(".underline").toggleClass("selected")}));n.get("editorContainer").addClass("undoreset");n.get("editorContainer").setHTML("");p.push(r.on("nodeChange",function(z){var C=z.changedType,F=z.changedNode,B,D,x,E=n.get("toolbar"),G;if(C=="tab"){G=v.one(".new-topic-form");if(G){if(G.one("#special-notice")){G.one("#special-notice").focus()}else{G.one(".topic-send ").focus()}return}}fontFamily=z.fontFamily?z.fontFamily:(F?F.getComputedStyle("fontFamily"):b);x=E.one("#menu-fontname");if(x){n.setFontNameInMenu(x,fontFamily)}fontSize=z.fontSize?z.fontSize:(F?F.getComputedStyle("fontSize"):f);fontSize=fontSize.replace(/pt|px/i,"");fontSize=n.fontSizeMatch(fontSize);x=E.one("#menu-fontsize");if(x){n.setFontSizeInMenu(x,fontSize)}B=F?F.getComputedStyle("color"):false;if(B){B=v.Color.toHex(B);x=E.one("#forecolor-panel");if(x){n.setFontColorInMenu(x,B)}}D=F?F.getComputedStyle("backgroundColor"):"#ffffff";D=D.toLowerCase()=="transparent"?"#ffffff":D;D=v.Color.toHex(D);x=E.one("#bgcolor-panel");if(x){n.setFontColorInMenu(x,D)}if(C==="keypress"||(!v.UA.ie&&C==="keydown")){return}if(C==="right"||C==="left"||C==="space"||C==="left-press"||C==="space-press"||C==="right-press"||C==="backspace-press"||C==="backspace"){return}if(C==="mouseup"||(v.UA.ie&&C.indexOf("up")!==-1&&F.get("tagName")!=="SPAN")){return}if(C==="mousedown"&&z.changedEvent&&z.changedEvent.which>1){return}var A=(F)?F.getComputedStyle("fontWeight"):null;if(A=="bold"||A==700){n._set("bold",true)}else{n._set("bold",false)}var y=(F)?F.getComputedStyle("fontStyle"):null;if(y=="italic"){n._set("italic",true)}else{n._set("italic",false)}var w=(F)?F.getComputedStyle("textDecoration"):null;if(w=="underline"){n._set("underline",true)}else{n._set("underline",false)}if(z.changedType=="backspace-up"&&v.UA.webkit){z.preventDefault()}}));if(n.enhancrSupported){var o=n.get("editorContainer").get("parentNode");p.push(r.on("link",function(y){n._linksCount++;var w,x=v.Lang.trim(y.node.getAttribute("href"));w=v.Array.indexOf(n._processedLinks,x);if(w==-1){w=n._processedLinks.push(x);n.processLink(y,w)}}));p.push(o.delegate("click",function(A){A.halt();var w,y,z=A.currentTarget,x=z.ancestor(".link-enhancr-attachment");w=x.getAttribute("data-index");y=x.one(".link-enhancr-card-url").getAttribute("href");x.remove();n._enhancedLinks--;n.fire("pv:removed",{index:w});if(n._enhancedNodes[w]){n._enhancedNodes[w].setHTML(y)}GROUPS.INSTR.beaconClick(n.get("rapidNode"),"en-del",2,false)},".link-enhancr-attachment .link-enhancr-delete"));p.push(o.delegate("click",function(w){w.halt()},".link-enhancr-attachment .link-enhancr-card-urlWrapper"));p.push(o.on("paste",function(A){var x=m(A.target,o),w,y,z=function(B){return document.createTreeWalker(B.getDOMNode(),NodeFilter.SHOW_TEXT)};n._timers.push(v.later(0,this,function(){o.all('div[class$="link-enhancr-attachment"]').setAttribute("contenteditable",false);v.each(o.all('div[class$="link-enhancr-attachment"]'),function(B){B.all("br").remove(true)})}));w=x.next();if(!w){w=x.cloneNode(true);y=z(w).firstChild();if(y){y.parentNode.innerHTML="&nbsp;"}x.ancestor().append(w)}}))}if(GROUPS.CONFIG.pinboardEnabled){p.push(n.node.delegate("click",function(w){if(n.node.one("#publish-post").get("checked")){n.node.one("#publish-post-tag").removeClass("hidden")}else{n.node.one("#publish-post-tag").addClass("hidden")}},"#publish-post",n));p.push(n.node.delegate("click",function(w){if(n.node.one("#publish-post")&&n.node.one("#publish-post-homepage").get("checked")&&!n.node.one("#publish-post").get("checked")){n.node.one("#publish-post").setAttribute("checked",true);n.node.one("#publish-post-tag").removeClass("hidden")}},"#publish-post-homepage",n));p.push(n.node.delegate("focus",function(w){if(n.node.one("#publish-post-tag .content").getHTML()==GROUPS.YRB_STRINGS.STR_POST_ADD_TAGS){n.node.one("#publish-post-tag .content").setHTML("")}},"#publish-post-tag .content",n));p.push(n.node.delegate("blur",function(w){if(n.node.one("#publish-post-tag .content").getHTML()==""&&!n.node.one("#publish-post-tag .post-tag")){n.node.one("#publish-post-tag .content").setHTML(GROUPS.YRB_STRINGS.STR_POST_ADD_TAGS)}},"#publish-post-tag .content",n));p.push(n.node.delegate("keyup",function(y){var x=n.node.one("#publish-post-tag .content"),w=v.Escape.html(x.getDOMNode().textContent);if(w.length>10){y.halt()}if(y.keyCode==13||y.keyCode==9){n.node.one("#publish-post-tag").insertBefore(v.Node.create('<div class="post-tag"><span>'+w+'</span><button class="yg-sprite yg-poll-del" type="button"></button></div>'),x);n.node.one("#publish-post-tag .content").setHTML("");n.node.one("#publish-post-tag .content").removeClass("notags");if(n.node.all("#publish-post-tag .post-tag").size()>=4){x.addClass("hide")}}},"#publish-post-tag .content",n));p.push(n.node.delegate("click",function(y){var x=y.target.ancestor(".post-tag"),w=x.get("parentNode");if(x){w.removeChild(x);if(n.node.all("#publish-post-tag .post-tag").size()<4){n.node.one("#publish-post-tag .content").removeClass("hide")}if(!n.node.one("#publish-post-tag .post-tag")){n.node.one("#publish-post-tag .content").setHTML(GROUPS.YRB_STRINGS.STR_POST_ADD_TAGS);n.node.one("#publish-post-tag .content").addClass("notags")}}},".yg-poll-del",n))}p.push(r.on("ready",function(){var B,A=r.getInstance();r.set("isReady",true);v.fire("rte:ready");p.push(n.get("editorContainer").on("focus",function(C){n.focus();B=v.one(".new-topic-form .feedback-area");if(B){B.addClass("hide")}}));p.push(n.get("editorContainer").on("keydown",function(C){C.stopPropagation()}));p.push(n.get("editorContainer").on("keypress",function(C){C.stopPropagation()}));if(n.get("focus")){r.focus()}n.initToolbar();var z=new v.CacheOffline({max:100,uniqueKeys:false,expires:60000}),x=z.retrieve("zax_sharephoto")?z.retrieve("zax_sharephoto").response:"";if(x!=""){var y=GROUPS.UTILS.startAConversation(x),w=v.one("#textarea-container div");w.appendChild(v.Node.create('<p id="yg-startaconversation"></p>'));n._enhancedNodes[0]=w;n.prepareDataForDisplay(0,y,true,{parentNode:v.one("#yg-startaconversation"),isEnter:true,aTagNode:v.one("#yg-startaconversation")});w.appendChild(v.Node.create('<p id="yg-startaconversation-after"></br></p>'));v.one("#yg-startaconversation-after").focus()}}));n._rte=r;n._evt=p;try{r.render(n.get("editorContainer"))}catch(t){v.log("Error: RTE render failed");v.one(".yg-rte-toolbar").addClass("hide");v.one(".new-topic-mailfrom").removeClass("hide");v.one(".new-topic-mailto").removeClass("hide")}if(n.get("quotedMessage")!==null){r.set("content",n.get("quotedMessage"))}if(n.get("plainTextMode")){n.switchMode("plain",s,true)}})},processLink:function(q,n){var p=this,o=e.Lang.trim(q.node.getAttribute("href"));GROUPS.DETAIL_IO.makeRequest("/api/v1/utils/urlEnhancer","POST",{url:o},function(v,w){if(w){p.handleFailureLinks(n)}else{var x,u,t,y=e.JSON.parse(v),r=y&&y.ygData;for(var s in r){x=r[s];if(x&&x.type){q.node.setHTML(x.title);p._enhancedNodes[n]=q.node;p._enhancedSuccess++;p._enhancedLinks++;t=m(q.node,q.node.ancestor("p"));p.prepareDataForDisplay(n,x,true,{parentNode:t,isEnter:q.trigger==="enter",aTagNode:q.node})}else{p.handleFailureLinks(n)}}}})},setFontColorInMenu:function(q,o){var p=q.one(".checkmark"),n;if(p){p.removeClass("checkmark")}p=null;n=q.all("li");n.each(function(r){if(r.getAttribute("data-value").toLowerCase().indexOf(o.toLowerCase())===0){p=r}});if(p){p.one(".ticker").addClass("checkmark")}},setFontNameInMenu:function(r,o){o=o.replace(/(\s|\'|\")/g,"");var q=r.one(".checkmark"),n,p;if(q){q.removeClass("checkmark")}q=null;n=r.all("li");n.each(function(s){p=s.getAttribute("data-value").replace(/(\s|\'|\")/g,"");if(p.toLowerCase().indexOf(o.toLowerCase())>=0){q=s}});if(q){q.one(".ticker").addClass("checkmark")}},setFontSizeInMenu:function(q,o){var p=q.one(".checkmark"),n;if(p){p.removeClass("checkmark")}p=null;p=q.one('li[data-value="'+o+'"]');if(p){p.one(".ticker").addClass("checkmark")}},fontSizeMatch:function(r){var s=10000,p,o=r,q,n=d.length;if(o>7){for(q=0;q<n;q++){p=Math.abs(r-d[q]);if(p<s){s=p;o=q}}o++}return o},handleFailureLinks:function(n){this._processedLinks[n]=""},prepareDataForDisplay:function(o,r,s,q){var p=this,n={cIndex:o,cardId:"enhancrCard_"+o,title:r.title,originTitle:r.title,cardUrl:r.requestedURL,hasImage:!!r.image.url,image:r.image.url,useBigCard:s,hasDescription:!!r.description,description:r.description,originDescription:r.description,cardWidth:k.CARD_WIDTH,cardTableWidth:k.CARD_WIDTH-2*k.BORDER_WIDTH,cardTextPartWidth:k.CARD_WIDTH-2*k.BORDER_WIDTH,originUrlDomain:this._currentDomain,displayHostname:r.displayHostname,hasVideoData:false,previewByMaxWidth:k.PREVIEW_BY_MAX_WIDTH,previewByMinWidth:k.PREVIEW_BY_MIN_WIDTH,evtHandlers:[]};n.cardViewOnMaxWidth=n.cardTextPartWidth-k.PREVIEW_BY_MAX_WIDTH;n.cardViewOnMinWidth=n.cardViewOnMaxWidth-k.PREVIEW_BY_PADDING_RIGHT_COMPOSE;if(r.type==="VIDEO"&&r.video.html){iframeNode=e.Node.create(r.video.html);n.videoWidth=iframeNode.get("width");n.videoHeight=iframeNode.get("height");n.videoSrc=iframeNode.get("src");n.hasVideoData=true}if(n.hasImage){tempImage={url:r.image.url,imageWidth:r.image.width,imageHeight:r.image.height};g(tempImage,n,function(t){p.handleRenderSlide(t,q)})}else{i(n);p.handleRenderSlide(n,q)}},handleRenderSlide:function(t,C){var p,v,w,n,r,B=this,s,A=t.cIndex;if(this._compiledEnhancer==""){this._compiledEnhancer=e.Handlebars.compile(GROUPS.UTILS.getTemplate("yg-enhancr-composed_template"))}p=e.Node.create(this._compiledEnhancer(t));r=this.node.one("#enhancrCard_"+A);if(r){r.replace(p)}else{if(this._enhancedNodes[A]){var u,o,z,y,q,x;u=C.parentNode;o=this.getLastCardNode(u);z=u===o;if(!(C.isEnter&&z)&&(!o.next()||o.next().get("tagName").toUpperCase()!=="P")){x=o.get("id");y='<p id="'+x+'"> &nbsp;</p>';q=e.Node.create(y);o.insert(q,"after")}o.insert(p,"after");this.fire("pv:added",{index:A})}}v=p.one(".link-enhancr-card-title");w=p.one(".link-enhancr-card-description");n=p.one(".link-enhancr-view-on");toggleButton=p.one(".link-enhancr-toggle");if(v){l(v,true)}if(w){l(w,true)}if(n){l(n,true,n.one(".link-enhancr-view-on-domain"))}s=t.evtHandlers;s.push(toggleButton.once("click",function(G){var E=t,F,D;G.halt();F=(E.useBigCard)?"en-shrnk":"en-expnd";GROUPS.INSTR.beaconClick(B.get("rapidNode"),F,1,false);E.useBigCard=!E.useBigCard;E.title=E.originTitle;E.description=E.originDescription;if(E.hasImage){D={url:E.image,imageWidth:E.originImageWidth,imageHeight:E.originImageHeight};e.each(s,function(H){H.detach()});g(D,E,function(H){B.handleRenderSlide(H)})}else{i(E);B.handleRenderSlide(E)}}))},getLastCardNode:function(n){return n},focus:function(){var n=this._rte;if(this.defaultContent!=""&&n.get("content").indexOf(this.defaultContent)!=-1){this._setContent(n.get("content").replace(this.defaultContent,""),true)}var o=this.get("toolbar").all(".toolbar-menu-container");o.each(function(r,q,p){r.addClass("hidden")})},initToolbar:function(){var v=this,t=v._evt,o,u,n,q,p,s=v.get("toolbar"),r=s.ancestor(".new-topic-container");if(r&&r.one(".i-close")){t.push(r.delegate("mousedown",function(w){v.removeFutureQ(w)},".i-close"))}r=r&&r.one(".compose-header");t.push(s.delegate("mousedown",function(x){x.preventDefault();x.stopPropagation();var w=x.currentTarget;if(w.hasClass("bold")){v._set("bold",!v.get("bold"))}else{if(w.hasClass("italic")){v._set("italic",!v.get("italic"))}else{if(w.hasClass("underline")){v._set("underline",!v.get("underline"))}}}v.executeCmd(w)},".rte-btn"));if(r){t.push(r.delegate("click",function(w){this.hideExpandHeader(w.currentTarget)},".expand-header, .collapse-header",this))}t.push(s.delegate("mousedown",function(y){y.preventDefault();var x=y.currentTarget,w=x.ancestor(".menu-group");x.ancestor(".toolbar-menu-container").addClass("hidden");v.executeCmd(x);if(x.one(".ticker")){if(w&&w.one(".checkmark")){w.one(".checkmark").removeClass("checkmark")}x.one(".ticker").addClass("checkmark")}},".picker-menuitem"));t.push(s.delegate("click",function(y){y.preventDefault();var w=y.currentTarget,x=y.target;v.removeFutureQ();s.all(".toolbar-menu-container").each(function(B,A){B.addClass("hidden")});if(w.hasClass("color")&&!x.hasClass("color-picker-menuitem")){v.showColorPicker(w,w.getAttribute("data-action"))}else{if(w.hasClass("emoticon")&&!x.hasClass("emoticon-picker-menuitem")){if(!GROUPS.YG_EMOTICON_IMAGES){var z=(GROUPS.HTTP_PROTOCOL=="https://")?"yg-s-emoticons.js":"yg-emoticons.js";e.Get.js(GROUPS.PAGE._getFilePath(z),function(A){if(!A){v.showEmoticons(w,w.getAttribute("data-action"))}})}else{v.showEmoticons(w,w.getAttribute("data-action"))}}else{if(w.hasClass("fontname")&&!x.hasClass("fontname-picker-item")){v.showFontNames(w,w.getAttribute("data-action"))}else{if(w.hasClass("rte-list")){v.showListMenu(w,w.getAttribute("data-action"))}else{if(w.hasClass("rte-indent")){v.showIndentMenu(w,w.getAttribute("data-action"))}else{if(w.hasClass("rte-justify")){v.showAlignMenu(w,w.getAttribute("data-action"))}}}}}}},".menu"));t.push(s.delegate("click",function(w){GROUPS.INSTR.beaconClick(v.get("rapidNode"),"rte-att",14,false)},".link-attachment",this));t.push(s.delegate("click",function(x){x.preventDefault();var w=x.currentTarget;if(w.hasClass("switch-text")){v.switchMode("plain",s)}else{if(w.hasClass("switch-html")){v.switchMode("html",s)}}},".switch-text,.switch-html"));t.push(s.delegate("click",function(w){e.one(".poll-container").removeClass("hide");e.one(".topic-send").addClass("btn-disabled");v.removeFutureQ();GROUPS.INSTR.beaconClick(v.get("rapidNode"),"rte-poll",1,false)},".poll-menu"));t.push(s.all(".menu").on("clickoutside",function(x){var w=x.target;if(!(w.hasClass("toolbar-menu-container")||w.hasClass("menu"))){s.all(".toolbar-menu-container").addClass("hidden")}},v.get("editorContainer")))},switchMode:function(z,A,x){var D=this;var u,C,p,y,q="/api/v1/utils/html_to_plaintext",B=new Object(),s,w,E,u,t;y=D._rte.getInstance();s=D.get("editorContainer");if(z=="plain"){D.removeFutureQ();var v=A.one(".switch-text");var o;if(x){o=true}else{o=window.confirm(GROUPS.YRB_STRINGS.RTE_SWITCH_PLAIN)}if(o==true){D.set("plainTextMode",true);t=s.all(".link-enhancr-attachment");e.each(t,function(n){cIndex=n.getAttribute("data-index");originUrl=n.one(".link-enhancr-card-url").getAttribute("href");n.remove();D._enhancedLinks--;D.fire("pv:removed",{index:cIndex});if(D._enhancedNodes[cIndex]){D._enhancedNodes[cIndex].setHTML(originUrl);D._enhancedNodes[cIndex].setAttribute("href","")}});p=D.getContent();A.one(">.poll-menu")&&A.one(">.poll-menu").addClass("hide");if(p.length>1){if(s){B.htmlMessage=p;E=D.getContent();E=E.replace(/<p>/g,"");E=E.replace(/<\/p>/g,"");if(E==D.defaultEditorContent){C=s.siblings(".plain-txt-area");if(!C.size()){s.insert(D.textAreaNode.cloneNode(true),"after")}s.addClass("hide")}else{GROUPS.DETAIL_IO.makeRequest(q,"POST",B,function(n,r){if(n){var F=e.JSON.parse(n);D.insertPlainTextArea(F.ygData,s)}else{D.insertPlainTextArea("",s)}})}D._setContent(p,false)}else{D._setContent(h.convertToPlain(e.Node.getDOMNode(y.one("doc").one("body")),true),false)}}v.setAttribute("alt",GROUPS.YRB_STRINGS.STR_SWITCH_TO_RTEXT);A.all(">.btn").addClass("hide");v.replaceClass("switch-text","switch-html");u=e.one(".maximized .quoted-container");if(u){u.addClass("hide")}}}else{var v=A.one(".switch-html");D.set("plainTextMode",false);if(s){var C=s.siblings(".plain-txt-area");if(C.size()){plainTxtCont=C.pop();w=plainTxtCont.get("value");plainTxtCont.addClass("hide");s.removeClass("hide");D._setContent(e.Escape.html(w),false)}}v.setAttribute("alt",GROUPS.YRB_STRINGS.STR_SWITCH_TO_PTEXT);A.all(">.btn").removeClass("hide");A.one(">.poll-menu")&&A.one(">.poll-menu").removeClass("hide");v.replaceClass("switch-html","switch-text")}},removeFutureQ:function(o){var p,n=this.get("toolbar"),p=n.ancestor(".new-topic-container");if(p&&p.one(".fque-container")){p.one(".fque-container").remove()}},executeCmd:function(s){var q=s.getAttribute("data-action"),p=s.getAttribute("data-value"),t=s.hasClass("menu"),n,o;try{if(p!=""){this._rte.execCommand(q,p)}else{this._rte.execCommand(q)}}catch(r){}this.removeFutureQ();n=this._rte.getInstance();o=new n.EditorSelection();this._rte.focus();o.focusCursor(true,true)},destroy:function(){var n;e.each(this._evt,function(o){o.detach()});n=this.get("toolbar").all(".selected");n.each(function(p,o){p.removeClass("selected")});e.each(this._timers,function(o){o.cancel()});this._rte.destroy(true);this.get("editorContainer").setHTML("");delete this._evt;if(this.get("editorContainer").ancestor(".new-topic-content").one("#plain-txt-area")){this.get("editorContainer").ancestor(".new-topic-content").one("#plain-txt-area").remove("true")}},showListMenu:function(u,r){var q=this.get("toolbar").one("#menu-rte-list"),t=u.get("offsetLeft"),n=this.get("toolbar").get("offsetWidth"),s=u.get("offsetHeight"),p,o;if(!q){o={menu:"rte-list",menuItems:[{action:"insertunorderedlist",altText:GROUPS.YRB_STRINGS.TOOLBAR_ALT_BULLETED_LIST,itemClass:"btn-bullets"},{action:"insertorderedlist",altText:GROUPS.YRB_STRINGS.TOOLBAR_ALT_NUMBERED_LIST,itemClass:"btn-numbers"}]};p=GROUPS.UTILS.getTemplate("toolbarSubMenu_template");p=e.Handlebars.compile(p);q=e.Node.create(p(o))}u.get("parentNode").insertBefore(q,u.nextSibling);q.setStyle("left",(t-1)+"px");q.setStyle("top",+s+"px");q.removeClass("hidden")},showIndentMenu:function(u,r){var q=this.get("toolbar").one("#menu-rte-indent"),t=u.get("offsetLeft"),n=this.get("toolbar").get("offsetWidth"),s=u.get("offsetHeight"),p,o;if(!q){o={menu:"rte-indent",menuItems:[{action:"indent",altText:GROUPS.YRB_STRINGS.TOOLBAR_ALT_INDENT_MORE,itemClass:"indent"},{action:"outdent",altText:GROUPS.YRB_STRINGS.TOOLBAR_ALT_INDENT_LESS,itemClass:"outdent"}]};p=GROUPS.UTILS.getTemplate("toolbarSubMenu_template");p=e.Handlebars.compile(p);q=e.Node.create(p(o))}u.get("parentNode").insertBefore(q,u.nextSibling);q.setStyle("left",t+"px");q.setStyle("top",+s+"px");q.removeClass("hidden")},showAlignMenu:function(u,r){var q=this.get("toolbar").one("#menu-rte-justify"),t=u.get("offsetLeft"),n=this.get("toolbar").get("offsetWidth"),s=u.get("offsetHeight"),p,o;if(!q){o={menu:"rte-justify",menuItems:[{action:"justifyleft",altText:GROUPS.YRB_STRINGS.TOOLBAR_ALT_ALIGN_LEFT,itemClass:"justifyleft"},{action:"justifycenter",altText:GROUPS.YRB_STRINGS.TOOLBAR_ALT_ALIGN_CENTER,itemClass:"justifycenter"},{action:"justifyright",altText:GROUPS.YRB_STRINGS.TOOLBAR_ALT_ALIGN_RIGHT,itemClass:"justifyright"}]};p=GROUPS.UTILS.getTemplate("toolbarSubMenu_template");p=e.Handlebars.compile(p);q=e.Node.create(p(o))}u.get("parentNode").insertBefore(q,u.nextSibling);q.setStyle("left",t+"px");q.setStyle("top",+s+"px");q.removeClass("hidden")},showColorPicker:function(n,r){var q=this.get("toolbar").one(".color-picker-container"),y,o,t,s,p=n.get("offsetLeft"),x=this.get("toolbar").get("offsetWidth"),w=this,u=n.get("offsetHeight"),v;if(!q){v={strText:GROUPS.YRB_STRINGS.STR_RTE_TEXT,strHighlight:GROUPS.YRB_STRINGS.STR_RTE_HIGHLIGHT,colors:c};t=c[0].length;s=c.length;source=GROUPS.UTILS.getTemplate("colorPicker_template");source=e.Handlebars.compile(source);q=e.Node.create(source(v));q.one("#forecolor-panel ul").get("children").slice(-1).item(0).addClass("cp-white");q.one("#bgcolor-panel ul").get("children").slice(-1).item(0).addClass("cp-white")}n.get("parentNode").insertBefore(q,n.nextSibling);if((s*q.one(".picker-menuitem").get("offsetWidth"))+p>x){q.setStyle("right","0px")}else{q.setStyle("left",p+"px")}q.setStyle("top",+u+"px");q.removeClass("hidden")},hideExpandHeader:function(o){var n,p=o.ancestor(".compose-header");p.one(".expand-header").toggleClass("hide");p.one(".collapse-header").toggleClass("hide");p.one(".new-topic-mailto").toggleClass("hide");if(o.hasClass("collapse-header")){if(!p.one("#reply-sender-txt").hasClass("hide")){p.one("#reply-sender-txt").addClass("hide")}}else{p.one("#reply-sender-txt").removeClass("hide")}p.one(".new-topic-mailfrom").toggleClass("hide");n=p.one(".selected-mailfrom").get("offsetWidth");if(p.one(".mailfrom-menu ul")){p.one(".mailfrom-menu ul").setStyle("width",(n-3)+"px")}if(p.one(".mailto-menu ul")){p.one(".mailto-menu ul").setStyle("width",(n-3)+"px")}},showEmoticons:function(y,A){var s=this.get("toolbar").one(".emoticon-picker-container"),n,o,D=8,E=10,p=y.get("offsetLeft"),w=y.get("offsetHeight"),v=GROUPS.YRB_STRINGS.EMOTICONS,x=GROUPS.YG_EMOTICON_IMAGES,z=this.get("toolbar").get("offsetWidth");if(!s){s=e.Node.create('<div unselectable="on" class="hidden toolbar-menu-container emoticon-picker-container"></div>');n='<ul unselectable="on" class="clrfix"></ul>',o='<li unselectable="on" class="picker-menuitem emoticon-picker-menuitem fleft"></li>';for(var C=0;C<D;C++){var u=e.Node.create(n);for(var B=1;B<=E;B++){var t=e.Node.create(o),q=E*C+B,F="emoticon_"+q;if(v[F]){var r='<img src="'+x[F]+'"/>';t.addClass(F);t.setAttribute("title",v[F]["altText"]);t.setAttribute("data-action","insertandfocus");t.setAttribute("data-value",r);u.append(t)}}s.append(u)}}y.get("parentNode").insertBefore(s,y.nextSibling);if((E*s.one(".picker-menuitem").get("offsetWidth"))+p>=z){s.setStyle("right","0px")}else{s.setStyle("left",p+"px")}s.removeClass("hidden");s.setStyle("top",+w+"px")},showFontNames:function(o,r){var s=this.get("toolbar").one("#menu-fontnamesize"),v,p,q=o.get("offsetLeft"),x=this.get("toolbar").get("offsetWidth"),t=o.get("offsetHeight"),n,u=GROUPS.YRB_STRINGS.FONT_TEXT,w;if(!s){w={str_rte_font_modern:GROUPS.YRB_STRINGS.STR_RTE_FONT_MODERN,str_rte_font_modernwide:GROUPS.YRB_STRINGS.STR_RTE_FONT_MODERNWIDE,str_rte_font_classic:GROUPS.YRB_STRINGS.STR_RTE_FONT_CLASSIC,str_rte_font_classicwide:GROUPS.YRB_STRINGS.STR_RTE_FONT_CLASSICWIDE,str_rte_font_courier:GROUPS.YRB_STRINGS.STR_RTE_FONT_COURIER,str_rte_font_garamond:GROUPS.YRB_STRINGS.STR_RTE_FONT_GARAMOND,str_rte_font_lucida:GROUPS.YRB_STRINGS.STR_RTE_FONT_LUCIDA,str_rte_font_modern_attr:b,str_rte_font_modernwide_attr:"verdana,HelveticaNeue,Helvetica Neue,Helvetica,Arial, sans-serif",str_rte_font_classic_attr:"times new roman,new york,times,serif",str_rte_font_classicwide_attr:"bookman old style,new york,times,serif",str_rte_font_courier_attr:"Courier New,courier,monaco,monospace,sans-serif",str_rte_font_garamond_attr:"garamond,new york,times,serif",str_rte_font_lucida_attr:"lucida console,sans-serif",str_rte_font_size_small:GROUPS.YRB_STRINGS.STR_RTE_FONT_SIZE_SMALL,str_rte_font_size_medium:GROUPS.YRB_STRINGS.STR_RTE_FONT_SIZE_MEDIUM,str_rte_font_size_large:GROUPS.YRB_STRINGS.STR_RTE_FONT_SIZE_LARGE,str_rte_font_size_xlarge:GROUPS.YRB_STRINGS.STR_RTE_FONT_SIZE_XLARGE};n=GROUPS.UTILS.getTemplate("fontnamessize_template");n=e.Handlebars.compile(n);s=e.Node.create(n(w))}o.get("parentNode").insertBefore(s,o.nextSibling);s.setStyle("left",(q-1)+"px");s.setStyle("top",+t+"px");s.removeClass("hidden")},_setContent:function(u,p){var n=this,o="",t=e.Selection.CURSOR,q=(!e.Lang.isUndefined(p))?p:true;t=(e.UA.ie===9)?"&nbsp;":e.Selection.CURSOR;o=(q)?"<p>"+t+"</p>":"";o+=u;n._rte.set("content",o);instance=n._rte.getInstance();instance.Selection.filter();if(e.UA.ie&&n._rte.frame._fixIECursors){n._rte.frame._fixIECursors()}try{selection=new instance.Selection();selection.focusCursor(true,true)}catch(s){}if(e.UA.ie&&e.UA.ie>=10){var r=n._rte.frame.get("container").one("p .yui-cursor");if(r){r.remove(true)}}},getContent:function(){return this._rte.getContent()},insertPlainTextArea:function(q,o){var p,n=o.siblings(".plain-txt-area");if(n.size()){p=n.pop();p.removeClass("hide");p.setHTML(q)}else{p=this.textAreaNode.cloneNode(true);o.insert(p,"after");o.siblings(".plain-txt-area");p.setHTML(q)}o.addClass("hide")}},{ATTRS:{editorContainer:{value:null},toolbar:{value:null},focus:{value:false},bold:{value:false},italic:{value:false},underline:{value:false},quotedMessage:{value:null},plainTextMode:{value:false},isReady:{value:false},enhancrEnabled:{value:true},rapidNode:{value:null},editMode:{value:false}}});e.namespace("Groups").RTE=a},"0.1",{requires:["node-base","cache","node-event-delegate","attribute-base","yg-helper-rteswitch"]});/*
YUI 3.15.0 (build 834026e)
Copyright 2014 Yahoo! Inc. All rights reserved.
Licensed under the BSD License.
http://yuilibrary.com/license/
*/

YUI.add("file-html5",function(e,t){var n=e.Lang,r=e.bind,i=e.config.win,s=function(e){var t=null;s.isValidFile(e)?t=e:s.isValidFile(e.file)?t=e.file:t=!1,s.superclass.constructor.apply(this,arguments),t&&s.canUpload()&&(this.get("file")||this._set("file",t),this.get("name")||this._set("name",t.name||t.fileName),this.get("size")!=(t.size||t.fileSize)&&this._set("size",t.size||t.fileSize),this.get("type")||this._set("type",t.type),t.hasOwnProperty("lastModifiedDate")&&!this.get("dateModified")&&this._set("dateModified",t.lastModifiedDate))};e.extend(s,e.Base,{initializer:function(t){this.get("id")||this._set("id",e.guid("file"))},_uploadEventHandler:function(e){var t=this.get("xhr");switch(e.type){case"progress":this.fire("uploadprogress",{originEvent:e,bytesLoaded:e.loaded,bytesTotal:this.get("size"),percentLoaded:Math.min(100,Math.round(1e4*e.loaded/this.get("size"))/100)}),this._set("bytesUploaded",e.loaded);break;case"load":if(t.status>=200&&t.status<=299){this.fire("uploadcomplete",{originEvent:e,data:e.target.responseText});var n=t.upload,r=this.get("boundEventHandler");n.removeEventListener("progress",r),n.removeEventListener("error",r),n.removeEventListener("abort",r),t.removeEventListener("load",r),t.removeEventListener("error",r),t.removeEventListener("readystatechange",r),this._set("xhr",null)}else this.fire("uploaderror",{originEvent:e,data:t.responseText,status:t.status,statusText:t.statusText,source:"http"});break;case"error":this.fire("uploaderror",{originEvent:e,data:t.responseText,status:t.status,statusText:t.statusText,source:"io"});break;case"abort":this.fire("uploadcancel",{originEvent:e});break;case"readystatechange":this.fire("readystatechange",{readyState:e.target.readyState,originEvent:e})}},startUpload:function(t,n,i){this._set("bytesUploaded",0),this._set("xhr",new XMLHttpRequest),this._set("boundEventHandler",r(this._uploadEventHandler,this));var s=new FormData,o=i||"Filedata",u=this.get("xhr"),a=this.get("xhr").upload,f=this.get("boundEventHandler");e.each(n,function(e,t){s.append(t,e)}),s.append(o,this.get("file")),u.addEventListener("loadstart",f,!1),a.addEventListener("progress",f,!1),u.addEventListener("load",f,!1),u.addEventListener("error",f,!1),a.addEventListener("error",f,!1),a.addEventListener("abort",f,!1),u.addEventListener("abort",f,!1),u.addEventListener("loadend",f,!1),u.addEventListener("readystatechange",f,!1),u.open("POST",t,!0),u.withCredentials=this.get("xhrWithCredentials"),e.each(this.get("xhrHeaders"),function(e,t){u.setRequestHeader(t,e)}),u.send(s),this.fire("uploadstart",{xhr:u})},cancelUpload:function(){var e=this.get("xhr");e&&e.abort()}},{NAME:"file",TYPE:"html5",ATTRS:{id:{writeOnce:"initOnly",value:null},size:{writeOnce:"initOnly",value:0},name:{writeOnce:"initOnly",value:null},dateCreated:{writeOnce:"initOnly",value:null},dateModified:{writeOnce:"initOnly",value:null},bytesUploaded:{readOnly:!0,value:0},type:{writeOnce:"initOnly",value:null},file:{writeOnce:"initOnly",value:null},xhr:{readOnly:!0,value:null},xhrHeaders:{value:{}},xhrWithCredentials:{value:!0},boundEventHandler:{readOnly:!0,value:null}},isValidFile:function(e){return i&&i.File&&e instanceof File},canUpload:function(){return i&&i.FormData&&i.XMLHttpRequest}}),e.FileHTML5=s},"3.15.0",{requires:["base"]});
/*
YUI 3.15.0 (build 834026e)
Copyright 2014 Yahoo! Inc. All rights reserved.
Licensed under the BSD License.
http://yuilibrary.com/license/
*/

YUI.add("uploader-queue",function(e,t){var n=function(){this.queuedFiles=[],this.uploadRetries={},this.numberOfUploads=0,this.currentUploadedByteValues={},this.currentFiles={},this.totalBytesUploaded=0,this.totalBytes=0,n.superclass.constructor.apply(this,arguments)};e.extend(n,e.Base,{_currentState:n.STOPPED,initializer:function(){},_uploadStartHandler:function(e){var t=e;t.file=e.target,t.originEvent=e,this.fire("uploadstart",t)},_uploadErrorHandler:function(e){var t=this.get("errorAction"),r=e,i,s;r.file=e.target,r.originEvent=e,this.numberOfUploads-=1,delete this.currentFiles[e.target.get("id")],this._detachFileEvents(e.target),e.target.cancelUpload(),t===n.STOP?this.pauseUpload():t===n.RESTART_ASAP?(i=e.target.get("id"),s=this.uploadRetries[i]||0,s<this.get("retryCount")&&(this.uploadRetries[i]=s+1,this.addToQueueTop(e.target)),this._startNextFile()):t===n.RESTART_AFTER&&(i=e.target.get("id"),s=this.uploadRetries[i]||0,s<this.get("retryCount")&&(this.uploadRetries[i]=s+1,this.addToQueueBottom(e.target)),this._startNextFile()),this.fire("uploaderror",r)},_startNextFile:function(){if(this.queuedFiles.length>0){var e=this.queuedFiles.shift(),t=e.get("id"),n=this.get("perFileParameters"),r=n.hasOwnProperty(t)?n[t]:n;this.currentUploadedByteValues[t]=0,e.on("uploadstart",this._uploadStartHandler,this),e.on("uploadprogress",this._uploadProgressHandler,this),e.on("uploadcomplete",this._uploadCompleteHandler,this),e.on("uploaderror",this._uploadErrorHandler,this),e.on("uploadcancel",this._uploadCancelHandler,this),e.set("xhrHeaders",this.get("uploadHeaders")),e.set("xhrWithCredentials",this.get("withCredentials")),e.startUpload(this.get("uploadURL"),r,this.get("fileFieldName")),this._registerUpload(e)}},_registerUpload:function(e){this.numberOfUploads+=1,this.currentFiles[e.get("id")]=e},_unregisterUpload:function(e){this.numberOfUploads>0&&(this.numberOfUploads-=1),delete this.currentFiles[e.get("id")],delete this.uploadRetries[e.get("id")],this._detachFileEvents(e)},_detachFileEvents:function(e){e.detach("uploadstart",this._uploadStartHandler),e.detach("uploadprogress",this._uploadProgressHandler),e.detach("uploadcomplete",this._uploadCompleteHandler),e.detach("uploaderror",this._uploadErrorHandler),e.detach("uploadcancel",this._uploadCancelHandler)},_uploadCompleteHandler:function(t){this._unregisterUpload(t.target),this.totalBytesUploaded+=t.target.get("size"),delete this.currentUploadedByteValues[t.target.get("id")],this.queuedFiles.length>0&&this._currentState===n.UPLOADING&&this._startNextFile();var r=t,i=this.totalBytesUploaded,s=Math.min(100,Math.round(1e4*i/this.totalBytes)/100);r.file=t.target,r.originEvent=t,e.each(this.currentUploadedByteValues,function(e){i+=e}),this.fire("totaluploadprogress",{bytesLoaded:i,bytesTotal:this.totalBytes,percentLoaded:s}),this.fire("uploadcomplete",r),this.queuedFiles.length===0&&this.numberOfUploads<=0&&(this.fire("alluploadscomplete"),this._currentState=n.STOPPED)},_uploadCancelHandler:function(e){var t=e;t.originEvent=e,t.file=e.target,this.fire("uploadcancel",t)},_uploadProgressHandler:function(t){this.currentUploadedByteValues[t.target.get("id")]=t.bytesLoaded;var n=t,r=this.totalBytesUploaded,i=Math.min(100,Math.round(1e4*r/this.totalBytes)/100);n.originEvent=t,n.file=t.target,this.fire("uploadprogress",n),e.each(this.currentUploadedByteValues,function(e){r+=e}),this.fire("totaluploadprogress",{bytesLoaded:r,bytesTotal:this.totalBytes,percentLoaded:i})},startUpload:function(){this.queuedFiles=this.get("fileList").slice(0),this.numberOfUploads=0,this.currentUploadedByteValues={},this.currentFiles={},this.totalBytesUploaded=0,this._currentState=n.UPLOADING;while(this.numberOfUploads<this.get("simUploads")&&this.queuedFiles.length>0)this._startNextFile()},pauseUpload:function(){this._currentState=n.STOPPED},restartUpload:function(){this._currentState=n.UPLOADING;while(this.numberOfUploads<this.get("simUploads"))this._startNextFile()},forceReupload:function(e){var t=e.get("id");this.currentFiles.hasOwnProperty(t)&&(e.cancelUpload(),this._unregisterUpload(e),this.addToQueueTop(e),this._startNextFile())},addToQueueTop:function(e){this.queuedFiles.unshift(e)},addToQueueBottom:function(e){this.queuedFiles.push(e)},cancelUpload:function(e){var t,r,i;if(e){t=e.get("id");if(this.currentFiles[t])this.currentFiles[t].cancelUpload(),this._unregisterUpload(this.currentFiles[t]),this._currentState===n.UPLOADING&&this._startNextFile();else for(r=0,len=this.queuedFiles.length;r<len;r++)if(this.queuedFiles[r].get("id")===t){this.queuedFiles.splice(r,1);break}}else{for(i in this.currentFiles)this.currentFiles[i].cancelUpload(),this._unregisterUpload(this.currentFiles[i]);this.currentUploadedByteValues={},this.currentFiles={},this.totalBytesUploaded=0,this.fire("alluploadscancelled"),this._currentState=n.STOPPED}}},{CONTINUE:"continue",STOP:"stop",RESTART_ASAP:"restartasap",RESTART_AFTER:"restartafter",STOPPED:"stopped",UPLOADING:"uploading",NAME:"uploaderqueue",ATTRS:{simUploads:{value:2,validator:function(e){return e>=1&&e<=5}},errorAction:{value:"continue",validator:function(e){return e===n.CONTINUE||e===n.STOP||e===n.RESTART_ASAP||e===n.RESTART_AFTER}},bytesUploaded:{readOnly:!0,value:0},bytesTotal:{readOnly:!0,value:0},fileList:{value:[],lazyAdd:!1,setter:function(t){var n=t;return e.Array.each(n,function(e){this.totalBytes+=e.get("size")},this),t}},fileFieldName:{value:"Filedata"},uploadURL:{value:""},uploadHeaders:{value:{}},withCredentials:{value:!0},perFileParameters:{value:{}},retryCount:{value:3}}}),e.namespace("Uploader"),e.Uploader.Queue=n},"3.15.0",{requires:["base"]});
/*
YUI 3.15.0 (build 834026e)
Copyright 2014 Yahoo! Inc. All rights reserved.
Licensed under the BSD License.
http://yuilibrary.com/license/
*/

YUI.add("uploader-html5",function(e,t){function i(){i.superclass.constructor.apply(this,arguments)}var n=e.Lang.sub,r=e.Uploader.Queue;e.UploaderHTML5=e.extend(i,e.Widget,{_fileInputField:null,_buttonBinding:null,queue:null,initializer:function(){this._fileInputField=null,this.queue=null,this._buttonBinding=null,this._fileList=[],this.publish("fileselect"),this.publish("uploadstart"),this.publish("fileuploadstart"),this.publish("uploadprogress"),this.publish("totaluploadprogress"),this.publish("uploadcomplete"),this.publish("alluploadscomplete"),this.publish("uploaderror"),this.publish("dragenter"),this.publish("dragover"),this.publish("dragleave"),this.publish("drop")},renderUI:function(){var t=this.get("contentBox"),n=this.get("selectFilesButton");n.setStyles({width:"100%",height:"100%"}),t.append(n),this._fileInputField=e.Node.create(i.HTML5FILEFIELD_TEMPLATE),t.append(this._fileInputField)},bindUI:function(){this._bindSelectButton(),this._setMultipleFiles(),this._setFileFilters(),this._bindDropArea(),this._triggerEnabled(),this.after("multipleFilesChange",this._setMultipleFiles,this),this.after("fileFiltersChange",this._setFileFilters,this),this.after("enabledChange",this._triggerEnabled,this),this.after("selectFilesButtonChange",this._bindSelectButton,this),this.after("dragAndDropAreaChange",this._bindDropArea,this),this.after("tabIndexChange",function(){this.get("selectFilesButton").set("tabIndex",this.get("tabIndex"))},this),this._fileInputField.on("change",this._updateFileList,this),this._fileInputField.on("click",function(e){e.stopPropagation()},this),this.get("selectFilesButton").set("tabIndex",this.get("tabIndex"))},_rebindFileField:function(){this._fileInputField.remove(!0),this._fileInputField=e.Node.create(i.HTML5FILEFIELD_TEMPLATE),this.get("contentBox").append(this._fileInputField),this._fileInputField.on("change",this._updateFileList,this),this._setMultipleFiles(),this._setFileFilters()},_bindDropArea:function(e){var t=e||{prevVal:null},n=this.get("dragAndDropArea");t.prevVal!==null&&(t.prevVal.detach("drop",this._ddEventHandler),t.prevVal.detach("dragenter",this._ddEventHandler),t.prevVal.detach("dragover",this._ddEventHandler),t.prevVal.detach("dragleave",this._ddEventHandler)),n!==null&&(n.on("drop",this._ddEventHandler,this),n.on("dragenter",this._ddEventHandler,this),n.on("dragover",this._ddEventHandler,this),n.on("dragleave",this._ddEventHandler,this))},_bindSelectButton:function(){this._buttonBinding=this.get("selectFilesButton").on("click",this.openFileSelectDialog,this)},_ddEventHandler:function(t){t.stopPropagation(),t.preventDefault();if(e.Array.indexOf(t._event.dataTransfer.types,"Files")>-1)switch(t.type){case"dragenter":this.fire("dragenter");break;case"dragover":this.fire("dragover");break;case"dragleave":this.fire("dragleave");break;case"drop":var n=t._event.dataTransfer.files,r=[],i=this.get("fileFilterFunction"),s;i?e.each(n,function(t){var n=new e.FileHTML5(t);i(n)&&r.push(n)}):e.each(n,function(t){r.push(new e.FileHTML5(t))}),r.length>0&&(s=this.get("fileList"),this.set("fileList",this.get("appendNewFiles")?s.concat(r):r),this.fire("fileselect",{fileList:r})),this.fire("drop",{fileList:r})}},_setButtonClass:function(e,t){t?this.get("selectFilesButton").addClass(this.get("buttonClassNames")[e]):this.get("selectFilesButton").removeClass(this.get("buttonClassNames")[e])},_setMultipleFiles:function(){this.get("multipleFiles")===!0?this._fileInputField.set("multiple","multiple"):this._fileInputField.set("multiple","")},_setFileFilters:function(){this.get("fileFilters").length>0?this._fileInputField.set("accept",this.get("fileFilters").join(",")):this._fileInputField.set("accept","")},_triggerEnabled:function(){this.get("enabled")&&this._buttonBinding===null?(this._bindSelectButton(),this._setButtonClass("disabled",!1),this.get("selectFilesButton").setAttribute("aria-disabled","false")):!this.get("enabled")&&this._buttonBinding&&(this._buttonBinding.detach(),this._buttonBinding=null,this._setButtonClass("disabled",!0),this.get("selectFilesButton").setAttribute("aria-disabled","true"))},_getFileList:function(){return this._fileList.concat()},_setFileList:function(e){return this._fileList=e.concat(),this._fileList.concat()},_updateFileList:function(t){var n=t.target.getDOMNode().files,r=[],i=this.get("fileFilterFunction"),s;i?e.each(n,function(t){var n=new e.FileHTML5(t);i(n)&&r.push(n)}):e.each(n,function(t){r.push(new e.FileHTML5(t))}),r.length>0&&(s=this.get("fileList"),this.set("fileList",this.get("appendNewFiles")?s.concat(r):r),this.fire("fileselect",{fileList:r})),this._rebindFileField()},_uploadEventHandler:function(e){switch(e.type){case"file:uploadstart":this.fire("fileuploadstart",e);break;case"file:uploadprogress":this.fire("uploadprogress",e);break;case"uploaderqueue:totaluploadprogress":this.fire("totaluploadprogress",e);break;case"file:uploadcomplete":this.fire("uploadcomplete",e);break;case"uploaderqueue:alluploadscomplete":this.queue=null,this.fire("alluploadscomplete",e);break;case"file:uploaderror":case"uploaderqueue:uploaderror":this.fire("uploaderror",e);break;case"file:uploadcancel":case"uploaderqueue:uploadcancel":this.fire("uploadcancel",e)}},openFileSelectDialog:function(){var e=this._fileInputField.getDOMNode();e.click&&e.click()},upload:function(t,n,r){var i=n||this.get("uploadURL"),s=r||this.get("postVarsPerFile"),o=t.get("id");s=s.hasOwnProperty(o)?s[o]:s,t instanceof e.FileHTML5&&(t.on("uploadstart",this._uploadEventHandler,this),t.on("uploadprogress",this._uploadEventHandler,this),t.on("uploadcomplete",this._uploadEventHandler,this),t.on("uploaderror",this._uploadEventHandler,this),t.on("uploadcancel",this._uploadEventHandler,this),t.startUpload(i,s,this.get("fileFieldName")))},uploadAll:function(e,t){this.uploadThese(this.get("fileList"),e,t)},uploadThese:function(t,n,i){if(!this.queue){var s=n||this.get("uploadURL"),o=i||this.get("postVarsPerFile");this.queue=new r({simUploads:this.get("simLimit"),errorAction:this.get("errorAction"
),fileFieldName:this.get("fileFieldName"),fileList:t,uploadURL:s,perFileParameters:o,retryCount:this.get("retryCount"),uploadHeaders:this.get("uploadHeaders"),withCredentials:this.get("withCredentials")}),this.queue.on("uploadstart",this._uploadEventHandler,this),this.queue.on("uploadprogress",this._uploadEventHandler,this),this.queue.on("totaluploadprogress",this._uploadEventHandler,this),this.queue.on("uploadcomplete",this._uploadEventHandler,this),this.queue.on("alluploadscomplete",this._uploadEventHandler,this),this.queue.on("uploadcancel",this._uploadEventHandler,this),this.queue.on("uploaderror",this._uploadEventHandler,this),this.queue.startUpload(),this.fire("uploadstart")}else this.queue._currentState===r.UPLOADING&&(this.queue.set("perFileParameters",this.get("postVarsPerFile")),e.each(t,function(e){this.queue.addToQueueBottom(e)},this))}},{HTML5FILEFIELD_TEMPLATE:"<input type='file' style='visibility:hidden; width:0px; height: 0px;'>",SELECT_FILES_BUTTON:'<button type="button" class="yui3-button" role="button" aria-label="{selectButtonLabel}" tabindex="{tabIndex}">{selectButtonLabel}</button>',TYPE:"html5",NAME:"uploader",ATTRS:{appendNewFiles:{value:!0},buttonClassNames:{value:{hover:"yui3-button-hover",active:"yui3-button-active",disabled:"yui3-button-disabled",focus:"yui3-button-selected"}},dragAndDropArea:{value:null,setter:function(t){return e.one(t)}},enabled:{value:!0},errorAction:{value:"continue",validator:function(e){return e===r.CONTINUE||e===r.STOP||e===r.RESTART_ASAP||e===r.RESTART_AFTER}},fileFilters:{value:[]},fileFilterFunction:{value:null},fileFieldName:{value:"Filedata"},fileList:{value:[],getter:"_getFileList",setter:"_setFileList"},multipleFiles:{value:!1},postVarsPerFile:{value:{}},selectButtonLabel:{value:"Select Files"},selectFilesButton:{valueFn:function(){return e.Node.create(n(e.UploaderHTML5.SELECT_FILES_BUTTON,{selectButtonLabel:this.get("selectButtonLabel"),tabIndex:this.get("tabIndex")}))}},simLimit:{value:2,validator:function(e){return e>=1&&e<=5}},uploadURL:{value:""},uploadHeaders:{value:{}},withCredentials:{value:!0},retryCount:{value:3}}}),e.UploaderHTML5.Queue=r},"3.15.0",{requires:["widget","node-event-simulate","file-html5","uploader-queue"]});
/*
YUI 3.15.0 (build 834026e)
Copyright 2014 Yahoo! Inc. All rights reserved.
Licensed under the BSD License.
http://yuilibrary.com/license/
*/

YUI.add("swfdetect",function(e,t){function c(e){return parseInt(e,10)}function h(e){i.isNumber(c(e[0]))&&(r.flashMajor=e[0]),i.isNumber(c(e[1]))&&(r.flashMinor=e[1]),i.isNumber(c(e[2]))&&(r.flashRev=e[2])}var n=0,r=e.UA,i=e.Lang,s="ShockwaveFlash",o,u,a,f,l;if(r.gecko||r.webkit||r.opera){if(o=navigator.mimeTypes["application/x-shockwave-flash"])if(u=o.enabledPlugin)a=u.description.replace(/\s[rd]/g,".").replace(/[A-Za-z\s]+/g,"").split("."),h(a)}else if(r.ie){try{f=new ActiveXObject(s+"."+s+".6"),f.AllowScriptAccess="always"}catch(p){f!==null&&(n=6)}if(n===0)try{l=new ActiveXObject(s+"."+s),a=l.GetVariable("$version").replace(/[A-Za-z\s]+/g,"").split(","),h(a)}catch(d){}}e.SWFDetect={getFlashVersion:function(){return String(r.flashMajor)+"."+String(r.flashMinor)+"."+String(r.flashRev)},isFlashVersionAtLeast:function(e,t,n){var i=c(r.flashMajor),s=c(r.flashMinor),o=c(r.flashRev);return e=c(e||0),t=c(t||0),n=c(n||0),e===i?t===s?n<=o:t<s:e<i}}},"3.15.0",{requires:["yui-base"]});
/*
YUI 3.15.0 (build 834026e)
Copyright 2014 Yahoo! Inc. All rights reserved.
Licensed under the BSD License.
http://yuilibrary.com/license/
*/

YUI.add("uploader-flash",function(e,t){function m(t,n,r){this._id=e.guid("yuiswf");var i=this._id,m=a.one(t),r=r||{},g=r.version||h,y=(g+"").split("."),b=s.isFlashVersionAtLeast(parseInt(y[0],10),parseInt(y[1],10),parseInt(y[2],10)),w=s.isFlashVersionAtLeast(8,0,0),E=w&&!b&&r.useExpressInstall,S=E?p:n,x="<object ",T,N,C="yId="+e.id+"&YUISwfId="+i+"&YUIBridgeCallback="+d+"&allowedDomain="+document.location.hostname;e.SWF._instances[i]=this;if(m&&(b||E)&&S){x+='id="'+i+'" ',u.ie?x+='classid="'+l+'" ':x+='type="'+c+'" data="'+f.html(S)+'" ',T="100%",N="100%",x+='width="'+T+'" height="'+N+'">',u.ie&&(x+='<param name="movie" value="'+f.html(S)+'"/>');for(var k in r.fixedAttributes)v.hasOwnProperty(k)&&(x+='<param name="'+f.html(k)+'" value="'+f.html(r.fixedAttributes[k])+'"/>');for(var L in r.flashVars){var A=r.flashVars[L];o.isString(A)&&(C+="&"+f.html(L)+"="+f.html(encodeURIComponent(A)))}C&&(x+='<param name="flashVars" value="'+C+'"/>'),x+="</object>",m.set("innerHTML",x),this._swf=a.one("#"+i)}else{var O={};O.type="wrongflashversion",this.publish("wrongflashversion",{fireOnce:!0}),this.fire("wrongflashversion",O)}}function y(){y.superclass.constructor.apply(this,arguments)}var n=e.Lang.sub,r=e.Uploader.Queue,i=e.Event,s=e.SWFDetect,o=e.Lang,u=e.UA,a=e.Node,f=e.Escape,l="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000",c="application/x-shockwave-flash",h="10.0.22",p="http://fpdownload.macromedia.com/pub/flashplayer/update/current/swf/autoUpdater.swf?"+Math.random(),d="SWF.eventHandler",v={align:"",allowFullScreen:"",allowNetworking:"",allowScriptAccess:"",base:"",bgcolor:"",loop:"",menu:"",name:"",play:"",quality:"",salign:"",scale:"",tabindex:"",wmode:""};m._instances=m._instances||{},m.eventHandler=function(e,t){m._instances[e]._eventHandler(t)},m.prototype={_eventHandler:function(e){e.type==="swfReady"?(this.publish("swfReady",{fireOnce:!0}),this.fire("swfReady",e)):e.type!=="log"&&this.fire(e.type,e)},callSWF:function(e,t){return t||(t=[]),this._swf._node[e]?this._swf._node[e].apply(this._swf._node,t):null},toString:function(){return"SWF "+this._id}},e.augment(m,e.EventTarget),e.SWF=m;var g=function(e){g.superclass.constructor.apply(this,arguments)};e.extend(g,e.Base,{initializer:function(t){this.get("id")||this._set("id",e.guid("file"))},_swfEventHandler:function(e){if(e.id===this.get("id"))switch(e.type){case"uploadstart":this.fire("uploadstart",{uploader:this.get("uploader")});break;case"uploadprogress":this.fire("uploadprogress",{originEvent:e,bytesLoaded:e.bytesLoaded,bytesTotal:e.bytesTotal,percentLoaded:Math.min(100,Math.round(1e4*e.bytesLoaded/e.bytesTotal)/100)}),this._set("bytesUploaded",e.bytesLoaded);break;case"uploadcomplete":this.fire("uploadfinished",{originEvent:e});break;case"uploadcompletedata":this.fire("uploadcomplete",{originEvent:e,data:e.data});break;case"uploadcancel":this.fire("uploadcancel",{originEvent:e});break;case"uploaderror":this.fire("uploaderror",{originEvent:e,status:e.status,statusText:e.message,source:e.source})}},startUpload:function(e,t,n){if(this.get("uploader")){var r=this.get("uploader"),i=n||"Filedata",s=this.get("id"),o=t||null;this._set("bytesUploaded",0),r.on("uploadstart",this._swfEventHandler,this),r.on("uploadprogress",this._swfEventHandler,this),r.on("uploadcomplete",this._swfEventHandler,this),r.on("uploadcompletedata",this._swfEventHandler,this),r.on("uploaderror",this._swfEventHandler,this),r.callSWF("upload",[s,e,o,i])}},cancelUpload:function(){this.get("uploader")&&(this.get("uploader").callSWF("cancel",[this.get("id")]),this.fire("uploadcancel"))}},{NAME:"file",TYPE:"flash",ATTRS:{id:{writeOnce:"initOnly",value:null},size:{writeOnce:"initOnly",value:0},name:{writeOnce:"initOnly",value:null},dateCreated:{writeOnce:"initOnly",value:null},dateModified:{writeOnce:"initOnly",value:null},bytesUploaded:{readOnly:!0,value:0},type:{writeOnce:"initOnly",value:null},uploader:{writeOnce:"initOnly",value:null}}}),e.FileFlash=g,e.UploaderFlash=e.extend(y,e.Widget,{_buttonState:"up",_buttonFocus:!1,_swfContainerId:null,_swfReference:null,queue:null,_tabElementBindings:null,initializer:function(){this._swfContainerId=e.guid("uploader"),this._swfReference=null,this.queue=null,this._buttonState="up",this._buttonFocus=null,this._tabElementBindings=null,this._fileList=[],this.publish("fileselect"),this.publish("uploadstart"),this.publish("fileuploadstart"),this.publish("uploadprogress"),this.publish("totaluploadprogress"),this.publish("uploadcomplete"),this.publish("alluploadscomplete"),this.publish("uploaderror"),this.publish("mouseenter"),this.publish("mouseleave"),this.publish("mousedown"),this.publish("mouseup"),this.publish("click")},renderUI:function(){var t=this.get("boundingBox"),r=this.get("contentBox"),i=this.get("selectFilesButton"),s=e.Node.create(n(y.FLASH_CONTAINER,{swfContainerId:this._swfContainerId})),o={version:"10.0.45",fixedAttributes:{wmode:"transparent",allowScriptAccess:"always",allowNetworking:"all",scale:"noscale"}};t.setStyle("position","relative"),i.setStyles({width:"100%",height:"100%"}),r.append(i),r.append(s),this._swfReference=new e.SWF(s,this.get("swfURL"),o)},bindUI:function(){this._swfReference.on("swfReady",function(){this._setMultipleFiles(),this._setFileFilters(),this._triggerEnabled(),this._attachTabElements(),this.after("multipleFilesChange",this._setMultipleFiles,this),this.after("fileFiltersChange",this._setFileFilters,this),this.after("enabledChange",this._triggerEnabled,this),this.after("tabElementsChange",this._attachTabElements)},this),this._swfReference.on("fileselect",this._updateFileList,this),this._swfReference.on("mouseenter",function(){this.fire("mouseenter"),this._setButtonClass("hover",!0),this._buttonState==="down"&&this._setButtonClass("active",!0)},this),this._swfReference.on("mouseleave",function(){this.fire("mouseleave"),this._setButtonClass("hover",!1),this._setButtonClass("active",!1)},this),this._swfReference.on("mousedown",function(){this.fire("mousedown"),this._buttonState="down",this._setButtonClass
("active",!0)},this),this._swfReference.on("mouseup",function(){this.fire("mouseup"),this._buttonState="up",this._setButtonClass("active",!1)},this),this._swfReference.on("click",function(){this.fire("click"),this._buttonFocus=!0,this._setButtonClass("focus",!0),e.one("body").focus(),this._swfReference._swf.focus()},this)},_attachTabElements:function(){if(this.get("tabElements")!==null&&this.get("tabElements").from!==null&&this.get("tabElements").to!==null){this._tabElementBindings!==null?(this._tabElementBindings.from.detach(),this._tabElementBindings.to.detach(),this._tabElementBindings.tabback.detach(),this._tabElementBindings.tabforward.detach(),this._tabElementBindings.focus.detach(),this._tabElementBindings.blur.detach()):this._tabElementBindings={};var t=e.one(this.get("tabElements").from),n=e.one(this.get("tabElements").to);this._tabElementBindings.from=t.on("keydown",function(e){e.keyCode===9&&!e.shiftKey&&(e.preventDefault(),this._swfReference._swf.setAttribute("tabindex",0),this._swfReference._swf.setAttribute("role","button"),this._swfReference._swf.setAttribute("aria-label",this.get("selectButtonLabel")),this._swfReference._swf.focus())},this),this._tabElementBindings.to=n.on("keydown",function(e){e.keyCode===9&&e.shiftKey&&(e.preventDefault(),this._swfReference._swf.setAttribute("tabindex",0),this._swfReference._swf.setAttribute("role","button"),this._swfReference._swf.setAttribute("aria-label",this.get("selectButtonLabel")),this._swfReference._swf.focus())},this),this._tabElementBindings.tabback=this._swfReference.on("tabback",function(){this._swfReference._swf.blur(),setTimeout(function(){t.focus()},30)},this),this._tabElementBindings.tabforward=this._swfReference.on("tabforward",function(){this._swfReference._swf.blur(),setTimeout(function(){n.focus()},30)},this),this._tabElementBindings.focus=this._swfReference._swf.on("focus",function(){this._buttonFocus=!0,this._setButtonClass("focus",!0)},this),this._tabElementBindings.blur=this._swfReference._swf.on("blur",function(){this._buttonFocus=!1,this._setButtonClass("focus",!1)},this)}else this._tabElementBindings!==null&&(this._tabElementBindings.from.detach(),this._tabElementBindings.to.detach(),this._tabElementBindings.tabback.detach(),this._tabElementBindings.tabforward.detach(),this._tabElementBindings.focus.detach(),this._tabElementBindings.blur.detach())},_setButtonClass:function(e,t){t?this.get("selectFilesButton").addClass(this.get("buttonClassNames")[e]):this.get("selectFilesButton").removeClass(this.get("buttonClassNames")[e])},_setFileFilters:function(){this._swfReference&&this.get("fileFilters").length>0&&this._swfReference.callSWF("setFileFilters",[this.get("fileFilters")])},_setMultipleFiles:function(){this._swfReference&&this._swfReference.callSWF("setAllowMultipleFiles",[this.get("multipleFiles")])},_triggerEnabled:function(){this.get("enabled")?(this._swfReference.callSWF("enable"),this._swfReference._swf.setAttribute("aria-disabled","false"),this._setButtonClass("disabled",!1)):(this._swfReference.callSWF("disable"),this._swfReference._swf.setAttribute("aria-disabled","true"),this._setButtonClass("disabled",!0))},_getFileList:function(){return this._fileList.concat()},_setFileList:function(e){return this._fileList=e.concat(),this._fileList.concat()},_updateFileList:function(t){e.one("body").focus(),this._swfReference._swf.focus();var n=t.fileList,r=[],i=[],s=this._swfReference,o=this.get("fileFilterFunction"),u;e.each(n,function(e){var t={};t.id=e.fileId,t.name=e.fileReference.name,t.size=e.fileReference.size,t.type=e.fileReference.type,t.dateCreated=e.fileReference.creationDate,t.dateModified=e.fileReference.modificationDate,t.uploader=s,r.push(t)}),o?e.each(r,function(t){var n=new e.FileFlash(t);o(n)&&i.push(n)}):e.each(r,function(t){i.push(new e.FileFlash(t))}),i.length>0&&(u=this.get("fileList"),this.set("fileList",this.get("appendNewFiles")?u.concat(i):i),this.fire("fileselect",{fileList:i}))},_uploadEventHandler:function(e){switch(e.type){case"file:uploadstart":this.fire("fileuploadstart",e);break;case"file:uploadprogress":this.fire("uploadprogress",e);break;case"uploaderqueue:totaluploadprogress":this.fire("totaluploadprogress",e);break;case"file:uploadcomplete":this.fire("uploadcomplete",e);break;case"uploaderqueue:alluploadscomplete":this.queue=null,this.fire("alluploadscomplete",e);break;case"file:uploaderror":case"uploaderqueue:uploaderror":this.fire("uploaderror",e);break;case"file:uploadcancel":case"uploaderqueue:uploadcancel":this.fire("uploadcancel",e)}},upload:function(t,n,r){var i=n||this.get("uploadURL"),s=r||this.get("postVarsPerFile"),o=t.get("id");s=s.hasOwnProperty(o)?s[o]:s,t instanceof e.FileFlash&&(t.on("uploadstart",this._uploadEventHandler,this),t.on("uploadprogress",this._uploadEventHandler,this),t.on("uploadcomplete",this._uploadEventHandler,this),t.on("uploaderror",this._uploadEventHandler,this),t.on("uploadcancel",this._uploadEventHandler,this),t.startUpload(i,s,this.get("fileFieldName")))},uploadAll:function(e,t){this.uploadThese(this.get("fileList"),e,t)},uploadThese:function(e,t,n){if(!this.queue){var i=t||this.get("uploadURL"),s=n||this.get("postVarsPerFile");this.queue=new r({simUploads:this.get("simLimit"),errorAction:this.get("errorAction"),fileFieldName:this.get("fileFieldName"),fileList:e,uploadURL:i,perFileParameters:s,retryCount:this.get("retryCount")}),this.queue.on("uploadstart",this._uploadEventHandler,this),this.queue.on("uploadprogress",this._uploadEventHandler,this),this.queue.on("totaluploadprogress",this._uploadEventHandler,this),this.queue.on("uploadcomplete",this._uploadEventHandler,this),this.queue.on("alluploadscomplete",this._uploadEventHandler,this),this.queue.on("alluploadscancelled",function(){this.queue=null},this),this.queue.on("uploaderror",this._uploadEventHandler,this),this.queue.startUpload(),this.fire("uploadstart")}}},{FLASH_CONTAINER:'<div id="{swfContainerId}" style="position:absolute; top:0px; left: 0px; margin: 0; padding: 0; border: 0; width:100%; height:100%"></div>'
,SELECT_FILES_BUTTON:"<button type='button' class='yui3-button' tabindex='-1'>{selectButtonLabel}</button>",TYPE:"flash",NAME:"uploader",ATTRS:{appendNewFiles:{value:!0},buttonClassNames:{value:{hover:"yui3-button-hover",active:"yui3-button-active",disabled:"yui3-button-disabled",focus:"yui3-button-selected"}},enabled:{value:!0},errorAction:{value:"continue",validator:function(e){return e===r.CONTINUE||e===r.STOP||e===r.RESTART_ASAP||e===r.RESTART_AFTER}},fileFilters:{value:[]},fileFilterFunction:{value:null},fileFieldName:{value:"Filedata"},fileList:{value:[],getter:"_getFileList",setter:"_setFileList"},multipleFiles:{value:!1},postVarsPerFile:{value:{}},selectButtonLabel:{value:"Select Files"},selectFilesButton:{valueFn:function(){return e.Node.create(n(e.UploaderFlash.SELECT_FILES_BUTTON,{selectButtonLabel:this.get("selectButtonLabel")}))}},simLimit:{value:2,validator:function(e){return e>=2&&e<=5}},swfURL:{valueFn:function(){var t="flashuploader.swf";return e.UA.ie>0?t+"?t="+e.guid("uploader"):t}},tabElements:{value:null},uploadURL:{value:""},retryCount:{value:3}}}),e.UploaderFlash.Queue=r},"3.15.0",{requires:["swfdetect","escape","widget","base","cssbutton","node","event-custom","uploader-queue"]});
/*
YUI 3.15.0 (build 834026e)
Copyright 2014 Yahoo! Inc. All rights reserved.
Licensed under the BSD License.
http://yuilibrary.com/license/
*/

YUI.add("uploader",function(e,t){var n=e.config.win;n&&n.File&&n.FormData&&n.XMLHttpRequest?e.Uploader=e.UploaderHTML5:e.SWFDetect.isFlashVersionAtLeast(10,0,45)?e.Uploader=e.UploaderFlash:(e.namespace("Uploader"),e.Uploader.TYPE="none")},"3.15.0",{requires:["uploader-html5","uploader-flash"]});
YUI.add("yg-message-poll",function(b){var a=b.Base.create("messagePoll",b.Base,[],{initializer:function(){var c=this;c.initPoll()},initPoll:function(){var e=this,f={},d=b.one(".poll-container"),c=d.ancestor().getData("date-format");if(d.getData("rendered")!=1){e.resetPoll();d=b.one(".poll-container")}e.optionCount=b.all("#yg-poll-options .new-poll-option").size();e.set("dateFormat",c);d.delegate("click",e.handlePollClose,".cancel-poll",e);d.delegate("click",e.handleDeletePoll,".delete-poll",e);d.delegate("click",e.handleAddOptions,".poll-more-options",e);d.delegate("click",e.handleDeleteOptions,".yg-poll-del",e);d.delegate("click",e.handleValidatePoll,".insert-poll",e);d.delegate("click",e.showAdvancedOptionsDialog,".advanced-options",e);if(GROUPS.PAGE._isDeskTop){b.use("dd-drop","dd-constrain","dd-proxy","dd-delegate","dd-ddm-drop","dd-drag",function(g){e.dragNDrop()})}e._errNode=d.one(".poll-notification");if(e._errNode){e._errNode.plug(b.Groups.Plugin.ErrorMsgNode)}},dragNDrop:function(){var c=this;c.drags=new b.DD.Delegate({container:"#yg-poll-options",nodes:".yg-poll-dd-container",target:true});c.drags.dd.plug(b.Plugin.DDProxy,{moveOnEnd:false,cloneNode:true});c.drags.dd.plug(b.Plugin.DDConstrained,{constrain2node:"#yg-poll-options"});c.drags.dd.addHandle(".yg-poll-dd");b.DD.DDM.on("drag:start",function(h){var f=h.target.get("node"),g=h.target.get("dragNode"),d="";f.setStyle("opacity",".5");d='<div class="clrfix yg-poll-dd-container">'+f.get("innerHTML")+"</div>";g.set("innerHTML",d);g.one(".new-poll-option").set("value",f.one(".new-poll-option").get("value"))});b.DD.DDM.on("drag:end",function(f){var d=f.target.get("node");d.setStyles({visibility:"",opacity:"1"})});b.DD.DDM.on("drag:drag",function(d){var f=d.target.lastXY[1];if(f<c.lastY){c.goingUp=true}else{c.goingUp=false}c.lastY=f});b.DD.DDM.on("drag:over",function(g){var d=g.drop.get("node"),f=g.drag.get("node");if(d.hasClass("yg-poll-dd-container")){if(!c.goingUp){d=d.get("nextSibling")}g.drop.get("node").get("parentNode").insertBefore(f,d);g.drop.sizeShim()}});b.DD.DDM.on("drag:drophit",function(f){var d=f.drop.get("node");if(!d.hasClass("yg-poll-dd-container")){d.appendChild(drag)}})},resetPoll:function(){var e=this,d=b.one(".poll-container"),c=e.get("dateFormat"),j={pollOptions:[{index:1},{index:2}],isMultiResponse:false,isPollResultVisible:true,isVoterIdentityVisible:false,canClosePollManually:true,sendResultsToCreator:false,canAddOptions:true,dateFormat:c},g=GROUPS.UTILS.getTemplate("messagePoll_Form_template"),h=b.Handlebars.compile(g),f=h(j),i=b.Node.create(f);e.set("hasPoll",false);e.set("pollSettings",{isMultiResponse:false,isPollResultVisible:true,isVoterIdentityVisible:false,canClosePollManually:true,sendResultsToCreator:false,canAddOptions:true,dateFormat:c,dateEnd:0});d.replace(i).removeClass("hide")},handlePollClose:function(g){var d=this,c=b.one(".poll-container"),f=c.ancestor(".new-topic-form");f.one(".topic-send").removeClass("btn-disabled");if(c.one("#yg-create-poll-done").getData("rendered")=="1"){c.one("#yg-create-poll").addClass("hide");c.one("#yg-create-poll-done").removeClass("hide")}else{c.addClass("hide")}},handleDeletePoll:function(i){var c=this,f=GROUPS.UTILS.getTemplate("messagePoll_DeleteDialog_template"),g=b.Handlebars.compile(f),d=g({}),h=b.Node.create(d);b.one("#yg-poll-delete-options-panel")&&b.one("#yg-poll-delete-options-panel").remove();b.one("body").appendChild(h);c._DeleteOptionsPanel=new b.Groups.Panel({srcNode:h.one("#yg-poll-delete-options-panel"),visible:true});h.removeClass("hide");h.one(".btn-cancel").on("click",function(j){c._DeleteOptionsPanel.hide(false,false,true)});h.one("#deleteoptions-confirm-btn").on("click",c.handleDeletePollConfirm,c)},handleDeletePollConfirm:function(){var d=this,c=b.one(".poll-container"),e=c.ancestor(".new-topic-form");if(d._DeleteOptionsPanel){d._DeleteOptionsPanel.hide(false,false,true)}GROUPS.INSTR.beaconClick("yg-action-bar","delete-poll-conv",1,false);e.one(".topic-send").removeClass("btn-disabled");d.destroy();d.initPoll()},handleAddOptions:function(j){var c=this,k=c.optionCount+1,i={index:k},f=GROUPS.UTILS.getTemplate("pollCreate_AddOption_template"),g=b.Handlebars.compile(f),d=g(i),h=b.Node.create(d);c.optionCount++;b.one("#yg-poll-options .yg-poll-dd-container:last-child").insert(h,"after");b.one("#yg-poll-options .yg-poll-dd-container:last-child input.new-poll-option").focus();c.drags.syncTargets();GROUPS.INSTR.beaconClick("yg-action-bar","Add poll option",5,false)},handleDeleteOptions:function(g){var l=this,m,f="",h=g.currentTarget,d=h.ancestor(),k="{{#yrb}}STR_POLLS_OPTIONS_PLACEHOLDER|{{index}}{{/yrb}}",j=b.Handlebars.compile(k);if(l.optionCount<3){return}d.remove(true);m=b.all("#yg-poll-options .new-poll-option");l.optionCount=m.size();for(var c=1;c<=l.optionCount;c++){f=j({index:c});m.item(c-1).setAttribute("placeholder",f)}},showAdvancedOptionsDialog:function(j){var c=this,i=c.get("pollSettings");i.formattedEndDate=(i.dateEnd!=0)?GROUPS.UTILS.getLocaleDate(i.dateEnd):"";var f=GROUPS.UTILS.getTemplate("messagePoll_OptionsDialog_template"),g=b.Handlebars.compile(f),d=g(i),h=b.Node.create(d);b.one("#yg-poll-edit-options-panel")&&b.one("#yg-poll-edit-options-panel").remove();b.one("body").appendChild(h);c._EditOptionsPanel=new b.Groups.Panel({srcNode:h.one("#yg-poll-edit-options-panel"),visible:true});h.removeClass("hide");h.one("#editoptions-cancel-btn").on("click",c.cancelAdvancedOptionsDialog,c);h.one("#editoptions-confirm-btn").on("click",c.closeAdvancedOptionsDialog,c)},cancelAdvancedOptionsDialog:function(){var c=this;if(c._EditOptionsPanel){c._EditOptionsPanel.hide(false,false,true)}},closeAdvancedOptionsDialog:function(){var q=this,p={},d=q.get("dateFormat"),c=b.one("#yg-poll-edit-options-panel"),i=c.one("[name=close]:checked").get("value"),k=c.one("[name=send]:checked").get("value"),e=c.one("[name=identity]:checked").get("value"),f=c.one("[name=result]:checked").get("value"),n=c.one("[name=addOptions]:checked").get("value"),m=c.one("[name=choice]:checked").get("value");p={isMultiResponse:m=="TRUE",isPollResultVisible:f=="ALWAYS",isVoterIdentityVisible:e=="DETAIL",canClosePollManually:i=="MANUAL",sendResultsToCreator:k=="CREATOR",canAddOptions:n=="TRUE",dateFormat:d,dateEnd:0};if(i!="MANUAL"){var g=c.one("#yg-poll-date").get("value"),l=b.Date.parse(g+" 23:59:00"),h=Math.round(+new Date(l)/1000),o=b.Date.parse(+new Date);if(!b.Date.isGreaterOrEqual(l,o)){var j=c.one(".error-node");j.removeClass("hide").addClass("error");j.set("text",GROUPS.YRB_STRINGS.STR_YOUR_POLL_CAN_NOT_CLOSE_IN_THE_PAST);return}p.dateEnd=h}if(q._EditOptionsPanel){q._EditOptionsPanel.hide(false,false,true)}q.set("pollSettings",p)},handleValidatePoll:function(j){var o=this,f=0,d=b.one(".poll-container"),g=o.get("pollSettings"),k=d.all(".new-poll-option"),c=encodeURIComponent(d.one("#poll-ask-question").get("value"));if(c==""){var m=b.Node.create("<div>"+GROUPS.YRB_STRINGS.STR_YOU_MUST_ENTER_A_QUESTION_FOR_THE_POLL+"</div>");o._errNode.errMsg.addAndShow(m);return}if(!g.canClosePollManually){var l=b.Date.parse(g.dateEnd*1000),n=b.Date.parse(+new Date);if(!b.Date.isGreaterOrEqual(l,n)){var m=b.Node.create("<div>"+GROUPS.YRB_STRINGS.STR_YOUR_POLL_CAN_NOT_CLOSE_IN_THE_PAST+"</div>");o._errNode.errMsg.addAndShow(m);return}}for(var h=0;h<o.optionCount;++h){if(k.item(h).get("value")!=""){f++}}if(f<2){var m=b.Node.create("<div>"+GROUPS.YRB_STRINGS.STR_YOU_MUST_ENTER_AT_LEAST_TW_CHOICES_FOR_YOUR_POLL+"</div>");o._errNode.errMsg.addAndShow(m);return}GROUPS.INSTR.beaconClick("yg-action-bar","insert-poll-conv",1,false);o.renderDonePoll()},handleReEditPoll:function(f){var d=this,c=b.one(".poll-container");GROUPS.INSTR.beaconClick("yg-action-bar","edit-poll-conv",1,false);c.one("#yg-create-poll .header h2").set("text",GROUPS.YRB_STRINGS.STR_EDIT_POLL);c.one("#yg-create-poll-done").addClass("hide");c.one("#yg-create-poll").removeClass("hide")},renderDonePoll:function(){var e=this,c=b.one(".poll-container"),f=c.ancestor(".new-topic-form"),d=b.Escape.html(c.one("#poll-ask-question").get("value"));e.set("hasPoll",true);c.one("#yg-create-poll").addClass("hide");c.one("#yg-create-poll-done").removeClass("hide");c.one("#yg-create-poll-done").setData("rendered","1");c.one("#yg-create-poll-done .second-message h2").set("innerHTML",d);e._timer=window.setTimeout(function(){e._timer=0;c.one("#yg-create-poll-done .first-message").hide(true);e._timer=window.setTimeout(function(){e._timer=0;c.one("#yg-create-poll-done .first-message").addClass("hide");c.one("#yg-create-poll-done .second-message").removeClass("hide")},500)},3000);c.delegate("click",e.handleReEditPoll,".message-container",e);c.delegate("click",e.handleReEditPoll,".re-edit",e);f.one(".topic-send").removeClass("btn-disabled")},createPoll:function(i){var e=this,c=b.one(".poll-container"),g=e.get("pollSettings");if(g.canClosePollManually){e.editPoll(0,i)}else{var h=b.Date.parse(g.dateEnd*1000),d=b.Date.parse(+new Date);if(b.Date.isGreaterOrEqual(h,d)){e.editPoll(g.dateEnd,i)}else{var f=GROUPS.YRB_STRINGS.STR_YOUR_POLL_CAN_NOT_CLOSE_IN_THE_PAST;i(f)}}},editPoll:function(c,d){var j=this,g=b.one(".poll-container"),v=j.get("pollSettings"),l="",r=0,h=Math.round(+new Date/1000),u=c,n=v.sendResultsToCreator?"CREATOR":"GROUP",t=v.isVoterIdentityVisible?"DETAIL":"COUNTS",p=v.isPollResultVisible?"ALWAYS":"WHEN_CLOSED",e=v.canAddOptions?"TRUE":"FALSE",k=v.isMultiResponse?"TRUE":"FALSE",s=encodeURIComponent(g.one("#poll-ask-question").get("value")),q=8,f=g.all(".new-poll-option");l+="dateCreated="+h+"&dateEnd="+u+"&sendToId="+n+"&resultsId="+t+"&visibleId="+p+"&surveyText="+s+"&flagBits="+q+"&multiResponse="+k+"&addOptions="+e+"&msgAttached=true";for(var o=0;o<j.optionCount;++o){if(f.item(o).get("value")!=""){l+="&selectionText="+encodeURIComponent(f.item(o).get("value"));r++}}if(s==""){var m=GROUPS.YRB_STRINGS.STR_YOU_MUST_ENTER_A_QUESTION_FOR_THE_POLL;d(m)}if(r<2){var m=GROUPS.YRB_STRINGS.STR_YOU_MUST_ENTER_AT_LEAST_TW_CHOICES_FOR_YOUR_POLL;d(m)}GROUPS.DETAIL_IO.makeRequest("/api/v1/groups/"+j.get("groupName")+"/polls","POST",l,function(i,w){if(w){var y=GROUPS.UTILS.getErrorYRBString(w.ygError.errorCode,"polls");d(y)}else{var x=b.JSON.parse(i);if((x&&x=="success")||!x.ygData){d("Error")}j.set("pollId",x.ygData.surveyId);d()}})},destroy:function(){var e=this,c=b.one(".poll-container"),d=b.Node.create('<div class="poll-container hide"></div>');c.insert(d,"before");c.remove(true)}},{ATTRS:{groupName:{value:""},pollId:{value:0},pollSettings:{value:{isMultiResponse:false,isPollResultVisible:true,isVoterIdentityVisible:false,canClosePollManually:true,sendResultsToCreator:false,canAddOptions:true,dateFormat:"mm/dd/yyyy",dateEnd:0}},hasPoll:{value:false},dateFormat:{value:"mm/dd/yyyy"}}});b.namespace("Groups").MessagePoll=a},"0.1",{requires:["json","handlebars","yg-plugin-error-node"]});YUI.add("yg-conversations-common",function(b){var a="";b.namespace("Groups.Conversations");b.Groups.Conversations=function(c,f,e,g){this.closeOverlay=function(i){var h=this,j=function(){if(h.newTopicRTE){h.newTopicRTE.destroy()}h.contentBox.one(".sub-container input").set("value","")};if(this.newTopicUploader){this.closeUploader(this.newTopicUploader,function(){j()})}else{j()}};this.closeUploader=function(l,m){if(l&&l.uploader){var i=l.contentBox;var k=i.one(".file-list-container"),h=l.uploadedFilesList,j=i.one(".link-attachment-container");j.addClass("hide");l.uploader.destroy(true);k.one(".file-list").setHTML("");k.addClass("hide");if(l.delegateHandle){l.delegateHandle.detach()}if(l.delegateHandle2){l.delegateHandle2.detach()}if(h.length>0){GROUPS.DETAIL_IO.makeRequest("/api/v1/groups/"+this.view.get("groupName")+"/messages","DELETE",{attachment:h},function(n,o){delete l;m()})}else{delete l;m()}}else{m()}};this.initMailFromOlay=function(q,n,s){var o=n.one(".mod-status"),r,h,m,j=b.WidgetPositionAlign,i,t,k,p,l=this.view.get("container"),u=this;if((o&&o.getContent()!=="")||n.hasClass("non-member")){if(o&&o.getContent()!==""){q.addClass("mod-true")}q.one(".drop-down").removeClass("hide");k={visible:false,srcNode:n,zIndex:1};if(GROUPS.PAGE._isMobile&&q.ancestor("#yg-msg-panel")){h=q.ancestor(".table-row");k.align={node:h,points:[j.TL,j.BL]};k.zIndex=1003;r=new b.Overlay(k);r.render();n.removeClass("hide");n.one("ul").setStyle("width","100%");n.one("ul").setStyle("overflow","hidden");r.get("boundingBox").setStyle("right","0px");m=h;h.on("click",function(v){if(!r.get("visible")){r.show()}else{r.hide()}})}else{k.align={node:q,points:[j.TL,j.TL]};q.addClass("btn-grey");q.addClass("rnd-crn-2");r=new b.Overlay(k);r.render();n.removeClass("hide");i=r.get("contentBox").get("offsetWidth")-20;t=q.ancestor(".table-cell").get("offsetWidth");i=i>t?t:i;q.setStyle("width",t-18+"px");m=q;p=r.get("contentBox").one("ul");p.setStyle("width",t-3+"px");q.setAttribute("tabindex","0");q.setAttribute("aria-haspopup","true");q.setAttribute("aria-expanded","false");b.use("plugin",function(v){p.plug(v.Plugin.NodeFocusManager,{descendants:"li",keys:{next:"down:40",previous:"down:38"},circular:true})});b.on("key",function(v){if(r.get("visible")){v.preventDefault();r.hide();q.setAttribute("aria-expanded","false");q.focus()}},[p,q],"down:27,9",this);q.on("click",function(v){r.show();q.setAttribute("aria-expanded","true")});q.on("key",function(v){r.show();q.setAttribute("aria-expanded","true");b.later(0,b,function(){p.focusManager.focus(0)})},"down:13, 40")}n.delegate("click",function(z){z.stopPropagation();r.hide();var v,x=z.currentTarget.one("span").getContent(),y=z.currentTarget.getData("value");q.one("span").setContent(x);q.one("span").get("parentNode").setAttribute("data-reply-to",z.currentTarget.getData("reply-to"));q.one("span").setAttribute("data-value",y);u.showReplyToInfo(true);q.setAttribute("aria-activedescendant",z.currentTarget.get("id"));q.setAttribute("aria-expanded","false");q.focus()},".options");m.on("clickoutside",function(v){r.hide();q.setAttribute("aria-expanded","false")})}};this.showReplyToInfo=function(t){var l=this.view.get("container"),q=GROUPS.YRB_STRINGS.STR_REPLY_SENT_TO,u,i,k,h,x,v=l.one("#reply-sender-txt"),s=true,p=this.view.get("groupName").toLowerCase()+"@"+GROUPS.EMAIL_DOMAIN,r=this.view.get("groupName").toLowerCase()+"-noreply@"+GROUPS.EMAIL_DOMAIN,m,n,o=this.view.get("groupName").toLowerCase()+"-owner@"+GROUPS.EMAIL_DOMAIN,j;if(l.one(".new-topic-mailto")){u=l.one(".new-topic-mailto").getData("reply-to-config");k=l.one(".new-topic-mailto").getData("is-reply")}else{u="other"}if(k){j=l.one(".selected-mailfrom span").getData("value");replyTo=l.one(".selected-mailto").getData("reply-to");i=j.indexOf(o);h=l.one(".selected-mailfrom span").getHTML();x=new RegExp(p);n=new RegExp(r);m=l.one(".mailfrom-menu ul");if(replyTo!=="LIST"&&replyTo!=="LIST_AND_SENDER"){if(i<0){h=h.replace(x,r);if(m){m.one("li span").setHTML(h)}}else{if(m){m.one("li span").setHTML(m.one("li span").getHTML().replace(x,r))}}}else{h=h.replace(n,p);if(m){m.one("li span").setHTML(m.one("li span").getHTML().replace(n,p))}}l.one(".selected-mailfrom span").setHTML(h);if(replyTo=="LIST"||replyTo=="LIST_AND_SENDER"){if(i>=0){q=q.replace("{0}",o)}else{j=b.Escape.html(j);switch(u){case"LIST":q=q.replace("{0}",p);break;case"LIST_AND_SENDER":q=q.replace("{0}",p+", "+j);break;case"SENDER":q=q.replace("{0}",j);break;case"OWNER":q=q.replace("{0}",o);break;default:s=false}}}else{q=q.replace("{0}",j)}}else{if(u=="other"){l=this.contentBox;j=l.one(".selected-mailfrom span").getData("value");v=l.one("#reply-sender-txt");q=q.replace("{0}",j)}else{j=l.one(".selected-mailfrom span").getData("value");switch(u){case"LIST":q=q.replace("{0}",p);break;case"LIST_AND_SENDER":q=q.replace("{0}",p+", "+b.Escape.html(j));break;case"SENDER":q=q.replace("{0}",b.Escape.html(j));break;case"OWNER":q=q.replace("{0}",o);break;default:s=false}}}if(s){v.one(".reply-info").setHTML(q);if(t){v.removeClass("hide")}}else{v.addClass("hide")}};this.showComposeEditor=function(l){var o,q=this,n,i,j,k,p=true;if(l!=null){l.preventDefault();j=l.recipientId;recipientUserId=l.recipientUserId;k=l.userId;actionType=l.actionType;if(typeof l.enhancrEnabled!="undefined"){p=l.enhancrEnabled}}if(this.conversationType=="pending"){p=false}if(q.node.one("#yg-msg-panel")){q.node.one("#yg-msg-panel").setHTML(q.node.one("#yg-msg-panel").getHTML().replace(/\{\{emailDomain\}\}/g,GROUPS.EMAIL_DOMAIN));i=q.node.one("#yg-msg-panel");i.one(".expand-header ").addClass("hide")}if(!this.ygPanel){this.ygPanel=new b.Groups.Panel({srcNode:i,moveNode:i.ancestor(".yui3-skin-sam"),width:Math.min((b.one("body").get("winWidth")*0.8),800)});i.removeClass("hide");if(typeof(l.fromModerator)!="undefined"&&l.fromModerator==true){if(i.one(".new-topic-mailto")){i.one(".new-topic-mailto").removeClass("hide")}if(i.one(".new-topic-mailfrom")){i.one(".new-topic-mailfrom").removeClass("hide")}}this.contentBox=this.ygPanel.get("contentBox");this.ygPanel.on("panel-hide",function(r){q.closeOverlay(r)});this.contentBox.one(".topic-cancel").on("click",function(r){q.ygPanel.hide();GROUPS.INSTR.beaconClick("yg-action-bar","topic-cancel",2,false)});this.contentBox.one(".topic-send").on("click",function(r){r.recipientId=j;r.userId=k;r.recipientUserId=recipientUserId;r.actionType=actionType;q.messageSendHandler(r);GROUPS.INSTR.beaconClick("yg-action-bar","topic-send",1,false)});this.initMailFromOlay(this.contentBox.one(".selected-mailfrom"),this.contentBox.one(".mailfrom-menu"));if(GROUPS.PAGE._isMobile){var m,h=i.one(".display-table");m=h.one(".new-topic-mailsubject");m.one("input").setAttribute("placeholder",GROUPS.YRB_STRINGS.STR_MAIL_SUBJECT);h.insert(m,"after")}}if(l&&l.actionType){if(actionType=="batch"){this.contentBox.one(".new-topic-mailto .recipient").setContent(GROUPS.YRB_STRINGS.STR_TO_MULTIPLE_MEMBERS)}else{this.contentBox.one(".new-topic-mailto .recipient").setContent(l.to)}}this.ygPanel.show();if(typeof l.fromModerator=="undefined"){this.contentBox.one("#reply-sender-txt").addClass("hide")}else{this.showReplyToInfo(true)}this.contentBox.one(".feedback-area").addClass("hide");this.newTopicUploader=new this.attachmentUploader(this.contentBox,this.view);n=this.contentBox.one('[name="topic-mailsubject"]');n.focus();n.on("focus",this.hideFeedback,this,this.contentBox.one(".feedback-area"));this.contentBox.one(".topic-send").removeClass("hide");this.contentBox.one(".topic-cancel").removeClass("hide");if(GROUPS.PAGE._isMobile){if(i){i.one(".content-area").setHTML('<textarea placeholder="'+GROUPS.YRB_STRINGS.STR_WRITE_NEW_MESSAGE+'"></textarea>')}}else{this.newTopicRTE=new b.Groups.RTE({enhancrEnabled:p,frameInstance:b,editorContainer:this.contentBox.one(".content-area"),toolbar:this.contentBox.one(".yg-rte-toolbar")});if(this.contentBox.one(".switch-html")){b.one(".rte-frame").ancestor(".content-area").addClass("hide");b.one(".rte-frame").ancestor(".content-area").insert(this.textAreaNode.cloneNode(true),"after");this.newTopicRTE.set("plainTextMode",true)}this.messagePoll=new b.Groups.MessagePoll({groupName:this.view.get("groupName")});if(GROUPS.CONFIG.pinboardEnabled){this.imageUploader=new b.Groups.InlineImage({contentBox:this.contentBox,view:this.view})}}};this.resizeTextArea=function(i){var h=i.currentTarget;h.setStyle("height","auto");h.setStyle("height",h.get("scrollHeight")+"px")};this.hideFeedback=function(i,h){h.addClass("hide")};this.attachmentUploader=function(i,h){this.initUploader=function(){var m=this.contentBox.one(".link-attachment-container .icon-holder");this.contentBox.one(".link-attachment-container").removeClass("hide");var j=this,l,k;GROUPS.PAGE.getAuthToken(GROUPS.DETAIL_IO,false);this.attWidget=new b.Groups.MessageAttachments({viewType:"fullView",container:this.contentBox,isUploader:true,});j.contentBox.one(".att-err-msg").addClass("hide");if(b.Uploader.TYPE!="none"){this.uploader=new b.Uploader({width:"10px",height:"10px",multipleFiles:true,swfURL:"/swf/flashuploader.swf?t="+Math.random(),simLimit:2,errorAction:b.Uploader.Queue.RESTART_AFTER,fileFieldName:"filedata",selectFilesButton:b.Node.create(b.one("#test-uploader").get("innerHTML")),withCredentials:false,fileFilterFunction:function(o){var n=GROUPS.MAX_ATTACHMENT_UPLOAD_SIZE<o.get("size");if(n){l=Math.round(GROUPS.MAX_ATTACHMENT_UPLOAD_SIZE/1048576);l=GROUPS.YRB_STRINGS.STR_ERR_FILE_UPLOAD.replace("{0}",l.toString());j.contentBox.one(".att-err-msg").setHTML(l);j.contentBox.one(".att-err-msg").removeClass("hide");b.later(6000,b,function(p){j.contentBox.one(".att-err-msg").addClass("hide")})}return !n}});this.uploader.render(m);this.uploadDone=true;this.uploader.set("uploadURL","/api/v2/groups/"+h.get("groupName")+"/messages/attachment?gapi_crumb="+GROUPS.YG_CRUMB);k=this.contentBox.one(".link-attachment");k.setStyle("height","");k.setStyle("width","");this.delegateHandle=this.contentBox.one(".file-list").delegate("click",function(n){j.anchorClickHandler(n)},".att-hover-remove",j);this.delegateHandle2=this.contentBox.one(".file-list").delegate("hover",function(n){if(this.one(".att-hover-remove")){this.one(".att-hover-remove").toggleClass("hide")}},function(n){if(this.one(".att-hover-remove")){this.one(".att-hover-remove").toggleClass("hide")}},".att-thumb");this.uploader.after("fileselect",function(n){j.fileSelectHandler(n)});this.uploader.on("uploadprogress",function(o){var p=j.contentBox.one("#"+o.file.get("id")+"_row"),n=o.file.get("size")*o.percentLoaded/100;n/=1000;if(n>1000){n/=1000;n=n.toFixed(1);n+=" MB"}else{n=n.toFixed(1);n+=" KB"}p.setAttribute("data-status","1");p.one(".file-status span").setStyle("width",o.percentLoaded+"%");j.uploading=true});this.uploader.on("totaluploadprogress",function(n){var o=Math.round(n.percentLoaded);j.contentBox.one(".num-attachments").setAttribute("aria-valuenow",o)});this.uploader.on("uploadcomplete",function(o){this.uploadDone=true;var p=j.contentBox.one("#"+o.file.get("id")+"_row"),n=b.JSON.parse(o.data);p.setAttribute("data-status","2");p.one(".file-status span").setStyle("width","100%");p.removeClass("att-uploading");p.one(".att-hover-remove").setAttribute("alt",GROUPS.YRB_STRINGS.STR_REMOVE);p.one(".att-thumb-hoverlay").addClass("hide");if(n.ygData){j.uploadedFilesList.push(n.ygData.attachmentPath);p.setAttribute("data-fileId",n.ygData.attachmentPath)}});this.uploader.on("uploaderror",function(p){var o=j.contentBox.one("#"+p.file.get("id")+"_row");o.one(".file-status").addClass("error");var n=b.JSON.parse(p.data);j.contentBox.one(".num-attachments").set("innerHTML",GROUPS.UTILS.getErrorYRBString(n.ygError.errorCode,"common_errors")).removeClass("spinner");j.uploading=false});this.uploader.on("alluploadscomplete",function(n){j.uploader.uploadDone=true;var o=j.uploadedFilesList.length;o=o>1?o+" "+GROUPS.YRB_STRINGS.STR_ATTACHMENTS:o+" "+GROUPS.YRB_STRINGS.STR_ATTACHMENT;j.contentBox.one(".num-attachments").set("text",o);j.contentBox.one(".num-attachments").removeClass("spinner");GROUPS.UTILS.notifyScreenReader(GROUPS.YRB_STRINGS.STR_UPLOAD_COMPLETE,true);j.uploader.set("fileList",[]);j.uploading=false});this.uploader.on("uploadstart",function(n){j.uploading=true;GROUPS.UTILS.notifyScreenReader(GROUPS.YRB_STRINGS.STR_ADDING_ATTACHMENTS,true)})}else{m.set("innerHTML",b.one("#test-uploader").get("innerHTML"));m.on("click",this.uploadAttachmentError)}};this.uploadAttachmentError=function(){b.one(".feedback-area").removeClass("hide").addClass("error").set("innerHTML",GROUPS.YRB_STRINGS.STR_UPLOADER_ERROR_1.replace("{0}",'<a href="https://get.adobe.com/flashplayer/" target="_blank">').replace("{1}","</a>"))};this.anchorClickHandler=function(q){var r=this;q.preventDefault();q.stopPropagation();var m=q.currentTarget.ancestor("li"),o=m.getAttribute("data-status"),p=m.getAttribute("data-index"),n=r.fileList[p],k=m.getAttribute("data-fileId");if(o=="1"){r.uploader.queue.cancelUpload(n);var l=(r.uploader.queue)?r.uploader.queue.queuedFiles.length:0,j=(r.uploader.queue)?b.Object.size(r.uploader.queue.currentFiles):0;if(l==0&&j==0){r.uploader.queue=null}delete r.fileList[p];this.removeCarouselItem(m)}else{if(o=="2"){delete r.fileList[p];GROUPS.DETAIL_IO.makeRequest("/api/v1/groups/"+h.get("groupName")+"/messages","DELETE",{attachment:[k]},function(u,v){for(var t=0,s=r.uploadedFilesList.length;t<s;t++){if(r.uploadedFilesList[t]===k){r.uploadedFilesList.splice(t,1);break}}r.removeCarouselItem(m)})}else{}}if(b.Object.size(r.fileList)==0){r.contentBox.one(".file-list-container").addClass("hide")}};this.removeCarouselItem=function(l){var j=parseInt(i.one(".attachment-ul").getStyle("width"),10);var k=l.get("offsetWidth");j=j-k+10;l.remove(true);if(j>0){this.contentBox.one(".attachment-ul").setStyle("width",j+"px");this.attWidget._initCarouselHandlers(k)}};this.fileSelectHandler=function(l){var k=l.fileList,m=this.contentBox.one(".file-list"),j=this;this.contentBox.one(".file-list-container").removeClass("hide"),oRecord={},width=0,iUlWidth=0;if(this.uploader.queue==null){this.uploadDone=true}else{if(this.uploader.queue.queuedFiles.length==0){this.uploader.queue=null;this.uploadDone=true}}w=0;if(m.one("li")){w=parseInt(i.one(".attachment-ul").getStyle("width"),10);iUlWidth=w}this.contentBox.one(".num-attachments").set("text",GROUPS.YRB_STRINGS.STR_ADDING_ATTACHMENTS);this.contentBox.one(".num-attachments").addClass("spinner");b.each(k,function(q,n){oRecord={};oRecord.id=q.get("id"),fileNode=b.one("#"+oRecord.id+"_row"),fileName=q.get("name");oRecord.fileName=b.Escape.html(fileName);oRecord.size=GROUPS.UTILS.formatBytes(q.get("size"));sFileType=q.get("type");if(j.attWidget.fileTypes[sFileType]){oRecord.colorCode=j.attWidget.fileTypes[sFileType].color;oRecord.typeAlias=j.attWidget.fileTypes[sFileType].alias}else{oRecord.colorCode="grey";oRecord.typeAlias=""}var o=j.attWidget._fCompiledTemplate(oRecord);var p=b.Node.create(o),n;m.append(p);n=(m.get("children").size()-1)+"";p.setAttribute("data-index",n);j.fileList[n]=q;width=p.get("offsetWidth");iUlWidth+=width+10;i.one(".attachment-ul").setStyle("width",iUlWidth+"px")});j.attWidget._initCarouselHandlers(width);if(this.uploadDone){this.uploadDone=false;this.uploader.uploadThese(k,null,{token:GROUPS.AUTH_TOKEN})}else{b.each(k,function(n){j.uploader.queue.addToQueueBottom(n)})}};this.contentBox=i;this.fileList={};this.uploadedFilesList=[];b.Uploader.SELECT_FILES_BUTTON='<div role="button" href="" class="yg-sprite link-attachment"></div>';this.uploading=false;this.initUploader()};this.showQuotedMessage=function(k){k.currentTarget.addClass("hide");var j,i,h=this;if(this.view.contentTransformed){i="/api/v1/groups/"+c.get("groupName")+"/messages/"+this.view.get("msgId")+"?edit=true";GROUPS.IO.makeRequest(i,"GET","",function(m,l){m=b.JSON.parse(m);if(!l){if(m.ygData&&m.ygData.messageBody){j=h.newMessageRTEArray[0].getContent();j+=h.view.qrString+m.ygData.messageBody;h.newMessageRTEArray[0]._setContent(j,false)}}})}else{if(this.quotedTxt){j=this.newMessageRTEArray[0].getContent();j+=this.quotedTxt;this.newMessageRTEArray[0]._setContent(j,false)}}};this.resetReplyBox=function(){b.one(".new-topic-mailto").addClass("hide");b.one(".new-topic-mailfrom").addClass("hide")};this.messageReplyHandler=function(E,C,u,F,o,q){var y=GROUPS.UTILS.getTemplate("newmessage_template"),t=GROUPS.UTILS.getTemplate("new-generic-editor_template"),v,s,G,n,m,q,j,l,k,x,A,i,h,r=(this.view.node.one(".msg-list-container").getData("attachment-status")=="1"),B=(this.view.node.one(".msg-list-container").getData("poll-enabled")=="1"),D=GROUPS.YALIAS?"'"+GROUPS.YALIAS+"' ":"";G=u.one(".compose-box");q=C=="pendingreject"?q:0;rapidNode=(typeof E.rapidNode!="undefined"&&E.rapidNode!=null)?E.rapidNode:null;if(G.one(".new-topic-form")){G.one(".yg-new-inline-message").removeClass("hide");s=G.one(".new-topic-form")}else{h=G.getAttribute("data-fromMailAddr");i=G.getAttribute("data-alternateId");j=new RegExp("^"+GROUPS.YRB_STRINGS.STR_RE+":","i");k=b.Handlebars.compile(t);l=b.Handlebars.compile(y);o=(C=="pendingreject"?o:b.one("#yg-msg-subject").getAttribute("data-subject"));o=b.Lang.trim(o);data={formType:"new-topic",includeOrigMsg:true,includeSubject:true,subject:j.test(o)?o:GROUPS.YRB_STRINGS.STR_RE+": "+o,fromMailAddr:h,fromMailAddrFull:D+h+" "+GROUPS.YRB_STRINGS.STR_VIA+" "+this.view.get("groupName")+" <"+this.view.get("groupName")+"@"+GROUPS.EMAIL_DOMAIN+">",alternateId:i?i.replace("{{emailDomain}}",GROUPS.EMAIL_DOMAIN):"",isMember:true,isAttEnabled:r,isIpad:GROUPS.PAGE._isIOS&&GROUPS.PAGE._isTablet,loaderIconUrl:GROUPS.LOADER_ICON_URL,isReply:true,replyTo:this.view.replyTo,isPollEnabled:B,isPinboardEnabled:GROUPS.CONFIG.pinboardEnabled};if(C=="pendingreject"){data.pendingMessage=true}switch(C){case"reply-all":data.recipient=this.view.get("groupName")+"@"+GROUPS.EMAIL_DOMAIN;break;case"reply":break}v=l({newMessageEditor:k(data)});s=b.Node.create(v);s.one(".content-area").setAttribute("data-default-content","");G.prepend(s);this.initMailFromOlay(G.one(".selected-mailfrom"),G.one(".mailfrom-menu"))}if(F&&!GROUPS.PAGE._isMobile){var z=b.Node.create("<div>"+F+"</div>");if(z.one(".card-action-bar")){z.one(".card-action-bar").remove(true);F=z.getHTML()}if(z.one(".qreply")){z.one(".qreply").removeClass("hide");z.one(".qreply").removeClass("qreply");F=z.getHTML()}if(C=="pendingreject"){F='<div class="ygroups-quoted" style="display:none">'+F+"</div>"}else{F='<div class="ygroups-quoted">'+F+"</div>"}this.quotedTxt=F;s.one(".quoted-container").removeClass("hide")}mailSubject=G.one('[name="topic-mailsubject"]');mailSubject.on("focus",this.hideFeedback,this,s.one(".feedback-area"));if(r){this.newMessageUploaderArray[q]=new this.attachmentUploader(G,this.view)}if(GROUPS.PAGE._isMobile&&C!="pendingreject"){G.one(".content-area").setHTML('<textarea placeholder="'+GROUPS.YRB_STRINGS.STR_WRITE_NEW_MESSAGE+'"></textarea>')}else{if(C=="pendingreject"){this.newMessageRTEArray[q]=new b.Groups.RTE({enhancrEnabled:false,editorContainer:G.one(".content-area"),frameInstance:u,focus:true,toolbar:G.one(".yg-rte-toolbar"),quotedMessage:F})}else{this.newMessageRTEArray[q]=new b.Groups.RTE({editorContainer:G.one(".content-area"),frameInstance:u,focus:true,toolbar:G.one(".yg-rte-toolbar"),rapidNode:rapidNode})}if(this.newMessageRTEArray[q].get("editorContainer").hasClass("hide")){A=b.one(".rte-frame").ancestor(".content-area");A.insert(this.textAreaNode.cloneNode(true),"after");this.newMessageRTEArray[q].set("plainTextMode",true)}b.one("#reply-sender-txt").addClass("hide");this.messagePoll=new b.Groups.MessagePoll({groupName:this.view.get("groupName")});if(GROUPS.CONFIG.pinboardEnabled){this.imageUploader=new b.Groups.InlineImage({contentBox:G,view:this.view})}}};this.messageSendHandler=function(k,l,i){var h=this,j=k.currentTarget.ancestor(".new-topic-form");if(h.messagePoll&&h.messagePoll.get("hasPoll")){h.messagePoll.createPoll(function(m){if(m){var n=j.one(".feedback-area");n.removeClass("hide");n.addClass("error");n.setHTML(m);return false}else{h.messageSendHandlerContinued(k,l,i,h)}})}else{if(!h.messagePoll||!(j.one(".topic-send").hasClass("btn-disabled"))){h.messageSendHandlerContinued(k,l,i,h)}else{if(typeof l=="function"){l.call(i,false)}}}};this.messageSendHandlerContinued=function(D,q,m,x){GROUPS.PAGE.hasUnsavedChanges=false;var z=x,A,v=false,u=D.currentTarget.ancestor(".new-topic-form"),B={subject:u.one('[name="topic-mailsubject"]').get("value"),isPopUp:true},H,p="/api/v1/groups/"+this.view.get("groupName")+"/messages/post?msgPost=true",k=u.one(".selected-mailfrom span").getData("value"),G=false,l=u.one(".feedback-area"),E,t,r;l.removeClass("error");if(!/[^\s]/.test(B.subject)){l.removeClass("hide");l.addClass("error");l.setHTML(GROUPS.YRB_STRINGS.STR_SUBJECT_EMPTY);return false}if(z.viewType=="newMessageInline"){var s,C,I=D.currentTarget.ancestor(".yg-msg-reply-container")?D.currentTarget.ancestor(".yg-msg-reply-container"):D.currentTarget.ancestor(".reply-box");E=u.one(".selected-mailto span").getContent();C=u.one(".selected-mailto").getData("reply-to");s="0";if(I){t=I.getData("uid");if(C=="SENDER"||C=="LIST_AND_SENDER"||C=="OWNER_AND_SENDER"){B.to=t;B.senderid=I.getData("sender-status")}}if(m.inReplyToHeaderValue){B.parentMessageHeaders=m.inReplyToHeaderValue}if(GROUPS.PAGE._isMobile&&u.one("textarea")){B.message=u.one("textarea").get("value")}else{if(this.newMessageRTEArray[s].get("plainTextMode")){A=this.newMessageRTEArray[s].get("editorContainer").siblings(".plain-txt-area");if(A.size()){B.message=A.pop().get("value")}else{B.message=b.one("#plain-txt-area").get("value")}v=true}else{B.message=this.newMessageRTEArray[s].getContent();if(this.newMessageRTEArray[s].enhancrSupported){B.numlinks=this.newMessageRTEArray[s]._linksCount;B.numret=this.newMessageRTEArray[s]._enhancedLinks;B.numprv=this.newMessageRTEArray[s]._enhancedSuccess;B.enhancrSupported=1}}}if(!/[^\s]/.test(B.message)||B.message=='<p><br class="yui-cursor"></p>'){l.removeClass("hide");l.addClass("error");l.setHTML(GROUPS.YRB_STRINGS.STR_EMPTY_MSG);return false}B.announce=false;B.replyto=C;if(this.newMessageUploaderArray&&this.newMessageUploaderArray[s]){if(this.newMessageUploaderArray[s].uploadedFilesList.length>0){B.attachment=this.newMessageUploaderArray[s].uploadedFilesList;this.newMessageUploaderArray[s].uploadedFilesList=[]}G=this.newMessageUploaderArray[s].uploading}if(!G){m.replyBox.one(".topic-send").addClass("hide");m.replyBox.one(".topic-cancel").addClass("hide");l.setHTML(GROUPS.YRB_STRINGS.STR_SENDING);l.removeClass("hide")}if(GROUPS.CONFIG.pinboardEnabled){B.createPost=u.one('[name="publish_post"]')?u.one('[name="publish_post"]').get("checked"):false;B.createPost=B.createPost?"true":"false";B.isPostVisibleForNonMembers=u.one('[name="isPostVisibleForNonMembers"]')?u.one('[name="isPostVisibleForNonMembers"]').get("checked"):false;B.isPostVisibleForNonMembers=B.isPostVisibleForNonMembers?"true":"false";var y=[];u.all(".post-tag").each(function(J){y.push(b.Escape.html(J.one("span").getHTML()))});if(u.one("#publish-post-tag .content")&&u.one("#publish-post-tag .content").getDOMNode().textContent!=""&&u.one("#publish-post-tag .content").getDOMNode().textContent!=GROUPS.YRB_STRINGS.STR_POST_ADD_TAGS){y.push(b.Escape.html(u.one("#publish-post-tag .content").getDOMNode().textContent))}if(y.length>0){B.postTags=y}if(z.imageUploader&&z.imageUploader.inlineImages.length>0){if(!B.attachment){B.attachment=[]}B.attachment.push(z.imageUploader.inlineImages)}}B.message=B.message.replace('class="ygroups-quoted" style="display:none"','class="ygroups-quoted"')}else{B.replyto="LIST";B.announce=u.one('[name="special_notice"]')?u.one('[name="special_notice"]').get("checked"):false;B.announce=B.announce?"true":"false";if(GROUPS.CONFIG.pinboardEnabled){B.createPost=u.one('[name="publish_post"]')?u.one('[name="publish_post"]').get("checked"):false;B.createPost=B.createPost?"true":"false";B.isPostVisibleForNonMembers=u.one('[name="isPostVisibleForNonMembers"]')?u.one('[name="isPostVisibleForNonMembers"]').get("checked"):false;B.isPostVisibleForNonMembers=B.isPostVisibleForNonMembers?"true":"false";var y=[];u.all(".post-tag").each(function(J){y.push(b.Escape.html(J.one("span").getHTML()))});if(u.one("#publish-post-tag .content")&&u.one("#publish-post-tag .content").getDOMNode().textContent!=""&&u.one("#publish-post-tag .content").getDOMNode().textContent!=GROUPS.YRB_STRINGS.STR_POST_ADD_TAGS){y.push(b.Escape.html(u.one("#publish-post-tag .content").getDOMNode().textContent))}if(y.length>0){B.postTags=y}if(z.imageUploader&&z.imageUploader.inlineImages.length>0){if(!B.attachment){B.attachment=[]}B.attachment.push(z.imageUploader.inlineImages)}}if(GROUPS.PAGE._isMobile&&u.one("textarea")){B.message=u.one("textarea").get("value")}else{if(this.newTopicRTE.get("plainTextMode")){A=this.newTopicRTE.get("editorContainer").siblings(".plain-txt-area");if(A.size()){B.message=A.pop().get("value")}else{B.message=b.one("#plain-txt-area").get("value")}v=true}else{B.message=this.newTopicRTE.getContent();if(this.newTopicRTE.enhancrSupported){B.numlinks=this.newTopicRTE._linksCount;B.numret=this.newTopicRTE._enhancedLinks;B.numprv=this.newTopicRTE._enhancedSuccess;B.enhancrSupported=1}}}if(!/[^\s]/.test(B.message)||B.message=='<br class="yui-cursor">'||B.message=="<p>"+GROUPS.YRB_STRINGS.STR_WRITE_NEW_MESSAGE+"</p>"){l.removeClass("hide");l.addClass("error");l.setHTML(GROUPS.YRB_STRINGS.STR_EMPTY_MSG);return false}if(D&&D.recipientId){B.inreplyto=D.recipientId;B.replyto="USERS";p="/api/v1/groups/"+this.view.get("groupName")+"/members/user/"+D.userId+"/messages?msgPost=true"}if(D&&D.recipientUserId){var h;B.replyto="USERS";p="/api/v1/groups/"+this.view.get("groupName")+"/messages?msgPost=true";if(D&&D.actionType=="batch"){recipientIds=D.recipientUserId.split(","),h=[],to="";b.each(recipientIds,function(J){h.push(J)})}else{h=D.recipientUserId}B.to=h}if(this.newTopicUploader&&this.newTopicUploader.uploadedFilesList){if(this.newTopicUploader.uploadedFilesList.length>0){if(!B.attachment){B.attachment=[]}B.attachment.push(this.newTopicUploader.uploadedFilesList);this.newTopicUploader.uploadedFilesList=[]}G=this.newTopicUploader.uploading}if(!G){u.one(".topic-send").addClass("hide");u.one(".topic-cancel").addClass("hide");l.removeClass("hide");l.setHTML(GROUPS.YRB_STRINGS.STR_SENDING)}}r=k.split("@");if(r){r=r[0]}if(r===this.view.get("groupName").toLowerCase()+"-owner"){B.fromemail=k}else{if(b.one(".mailfrom-menu").hasClass("non-member")){if(/&lt;(.*)&gt;/.test(k)){var j=k.match(/&lt;(.*)&gt;/);B.fromemail=j[1]}else{B.fromemail=k}}}var o=/((<br>\s*)|(<p><\/p>))+/,i=/(<br class="yui-cursor">)/;B.message=B.message.replace(i,"");B.message=B.message.replace(o,"");if(v){B.plainTextMessage=b.helper.rteswitch.clearHtml(B.message);delete B.message}else{var F="",n={};if(B.enhancrSupported){n={numlinks:B.numlinks,numprv:B.numprv,numret:B.numret};F="post";delete B.numprv;delete B.numlinks;delete B.numret;delete B.enhancrSupported}if(B.attachment){F+="-att"}if(z.messagePoll&&z.messagePoll.get("pollId")!=0){B.surveyId=z.messagePoll.get("pollId");n.pollid=B.surveyId;F+="-poll"}if(B.createPost){F+="-post"}GROUPS.INSTR.beaconClick("yg-action-bar","msg-post",1,false,n,F)}if(!G){GROUPS.DETAIL_IO.makeRequest(p,"POST",B,function(K,L){var J=false;if(K){var M=b.JSON.parse(K);if(M.ygData){J=true;if(z.viewType=="newMessageInline"){z.replyCancelHandler(D);l.setHTML(GROUPS.YRB_STRINGS.STR_MSG_PROCESSED)}else{if(z.viewType=="newTopicInline"){l.setHTML(GROUPS.YRB_STRINGS.STR_MSG_PROCESSED);z.replyCancelHandler(D)}else{l.setHTML(GROUPS.YRB_STRINGS.STR_MSG_PROCESSED);b.later(1000,b,function(N){z.ygPanel.hide()})}}}else{l.setHTML(GROUPS.YRB_STRINGS.STR_MESSAGE_SEND_ERROR);u.one(".topic-send").removeClass("hide");u.one(".topic-cancel").removeClass("hide");l.addClass("error")}}if(L){l.setHTML(GROUPS.YRB_STRINGS.STR_MESSAGE_SEND_ERROR);u.one(".topic-send").removeClass("hide");u.one(".topic-cancel").removeClass("hide");l.addClass("error")}if(typeof q=="function"){q.call(m,J)}if(z.viewType=="newMessageInline"){b.later(3000,b,function(N){l.addClass("hide")})}})}};this.showButtons=function(h){h.one(".topic-send").removeClass("hide");h.one(".topic-cancel").removeClass("hide")};this.replyCancelHandler=function(j){var h=j.currentTarget.ancestor(".yg-new-inline-message"),i=j.currentTarget.ancestor(".yg-msg-read-container");index=(i)?i.getAttribute("data-index"):"0";this.closeUploader(this.newMessageUploaderArray[index],function(){if(h){h.addClass("hide")}if(d.newMessageRTEArray[index]){d.newMessageRTEArray[index].destroy()}if(d.viewType=="newTopicInline"){var k=b.one("#yg-action-bar #yg-back-arrow").getAttribute("href");GROUPS.ROUTER.navigate(k)}if(d.messagePoll){d.messagePoll.destroy()}})};this.inlineMessageHandler=function(k){var i=this;this.newMessageUploaderArray={};k.one("body").delegate("click",function(l){i.messageReplyHandler(l,"reply-all",k)},".reply-all-link");k.one("body").delegate("click",function(l){i.replyCancelHandler(l)},".topic-cancel");k.one("body").delegate("click",function(l){i.messageSendHandler(l)},".topic-send");var h=k.all(".reply-all-link"),j=k.all(".msg-count");j.on("mouseover",function(l){GROUPS.PAGE.showTooltip(l,tooltipNode,true)},GROUPS.PAGE);j.on("mouseout",function(l){GROUPS.PAGE.hideTooltip()},GROUPS.PAGE)};this.newTopicInit=function(){var h=this;b.one("#yg-action-bar").delegate("click",this.showNewTopic,".new-topic",this);b.one("#yg-action-bar").delegate("key",this.showNewTopic,"down:13",".new-topic",this)};this.showNewTopic=function(j){var h=this,i=b.one(".mailfrom-menu").hasClass("non-member");if(!h.allowedEmailAddr&&i){GROUPS.IO.makeRequest("/api/v1/user/profile","GET","",function(o,n){if(!n){o=b.JSON.parse(o);if(o&&o.ygData["emails"]["ALLOWED"]){h.allowedEmailAddr=o.ygData["emails"]["ALLOWED"];if(/&lt;&gt;/.test(b.one(".selected-mailfrom span").getContent())&&h.allowedEmailAddr.length>0){var k=b.one(".selected-mailfrom span").getContent(),m=b.one(".mailfrom-menu li").getContent().replace("&lt;&gt;","&lt;"+h.allowedEmailAddr[0]+"&gt;");k=k.replace("&lt;&gt;","&lt;"+h.allowedEmailAddr[0]+"&gt;");b.one(".selected-mailfrom span").setContent(k).setAttribute("data-value",h.allowedEmailAddr[0]);b.one(".mailfrom-menu ul").setContent('<li class="options" data-value="'+h.allowedEmailAddr[0]+'">'+m+"</li>")}for(var l=1;l<h.allowedEmailAddr.length;l++){var p=b.Node.create('<li class="options" data-value="'+h.allowedEmailAddr[l]+'"> <span>'+h.allowedEmailAddr[l]+"</span></li>");b.one(".mailfrom-menu ul").append(p)}h.initMailFromOlay(h.contentBox.one(".selected-mailfrom"),h.contentBox.one(".mailfrom-menu"));h.showReplyToInfo(false);b.one(".selected-mailfrom .drop-down").removeClass("hide")}}})}if(h.viewType=="newTopicInline"){if(!i){h.initMailFromOlay(h.contentBox.one(".selected-mailfrom"),h.contentBox.one(".mailfrom-menu"));h.showReplyToInfo(false)}}else{j.enhancrEnabled=false;h.showComposeEditor(j)}};this.init=function(h,j){var i=this;this.ygPanel=null;this.view=h;this.attUploader=null;this.newMessageUploaderArray={};this.newMessageRTEArray={};this.newTopicUploader=null;this.newTopicRTE=null;this.messagePoll=null;this.textAreaNode=b.Node.create('<textarea placeholder="'+GROUPS.YRB_STRINGS.STR_WRITE_NEW_MESSAGE+'" id="plain-txt-area"></textarea>');this.viewType=j.viewType;switch(j.viewType){case"newTopic":this.node=this.view.get("container");if(!j.newTopicHandled){this.newTopicInit()}break;case"newMessageInline":this.conversationType=j.conversationType;break;case"newTopicInline":j.callback.call(h,this);break}};var d=this;b.use("yg-panel","uploader","yg-rte","overlay","yg-message-attachments","yg-message-poll","yg-inline-image",function(h){d.init(c,f);if(typeof e!="undefined"&&e=="1"){d.showComposeEditor(null)}if(typeof(g)=="function"){g()}})}},"0.1",{requires:["node","base","event"]});